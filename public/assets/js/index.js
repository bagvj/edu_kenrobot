/*! jquery.cookie v1.4.1 | MIT */

define("app/EventManager",[],function(){function e(e,n){return e+"_"+n}function n(n,t,a){var o=e(n,t),r=i[o];r||(r=[],i[o]=r),r.push(a)}function t(n,t,a){var o=e(n,t),r=i[o];if(r)for(var c=0;c<r.length;c++){var s=r[c];if(s==a){r.splice(c,1);break}}}function a(n,t,a){var o=e(n,t),r=i[o];if(r)for(var c=0;c<r.length;c++){var s=r[c];s(a)}}var i={};return{bind:n,unbind:t,trigger:a}}),define("app/util",[],function(){function e(e){var n=400;$("div.x-message").stop(!0).fadeOut(n/2,function(){$(this).remove()}),e="string"==typeof e?{text:e}:e;var t=e.type||"info",a=e.text,i='<div class="x-message alert alert-'+t+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+a+"</div>",o=$(i);o.appendTo($(".message-layer")).css({left:($(window).width()-o.width())/2,top:-o.height()}).animate({top:150},n,"swing").delay(2e3).fadeOut(n,function(){$(this).remove()})}function n(e){e="string"==typeof e?{selector:e}:e;var n=e.selector,t=$(n);if(!t||!t.hasClass("x-dialog"))return!1;var a=e.onConfirm,i=e.onCancel,o=e.onClosing,r=e.onClose,c=e.onShow,s=e.content;s&&$(".x-dialog-content",t).text(s);var u=$(".dialog-layer").addClass("active"),d=function(){t.slideUp(200,function(){t.hide().removeClass("active"),u.removeClass("active"),r&&r()})};return $(".x-dialog-btns .confirm",t).off("click").on("click",function(){o&&0==o()||(d(),a&&a())}),$(".x-dialog-close,.x-dialog-btns .cancel",t).off("click").on("click",function(){o&&0==o()||(d(),i&&i())}),t.css({top:-t.height()}),function(){c&&c(),t.show().addClass("active").animate({top:200},300,"swing")}(),t}function t(){return $(".dialog-layer").hasClass("active")}function a(e,n,t){return n=n||"li",t?e.hasClass("active")?(e.removeClass("active"),!1):(e.parent().find(n+".active").removeClass("active"),e.addClass("active"),!0):e.hasClass("active")?!1:(e.parent().find(n+".active").removeClass("active"),e.addClass("active"),!0)}return{message:e,dialog:n,isInDialog:t,toggleActive:a}}),!function(e){e(jQuery)}(function(e){function n(e){return c.raw?e:encodeURIComponent(e)}function t(e){return c.raw?e:decodeURIComponent(e)}function a(e){return n(c.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),c.json?JSON.parse(e):e}catch(n){}}function o(n,t){var a=c.raw?n:i(n);return e.isFunction(t)?t(a):a}var r=/\+/g,c=e.cookie=function(i,r,s){if(void 0!==r&&!e.isFunction(r)){if(s=e.extend({},c.defaults,s),"number"==typeof s.expires){var u=s.expires,d=s.expires=new Date;d.setTime(+d+864e5*u)}return document.cookie=[n(i),"=",a(r),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var l=i?void 0:{},f=document.cookie?document.cookie.split("; "):[],p=0,g=f.length;g>p;p++){var v=f[p].split("="),m=t(v.shift()),h=v.join("=");if(i&&i===m){l=o(h,r);break}i||void 0===(h=o(h))||(l[m]=h)}return l};c.defaults={},e.removeCookie=function(n,t){return void 0===e.cookie(n)?!1:(e.cookie(n,"",e.extend({},t,{expires:-1})),!e.cookie(n))}}),define("vendor/jquery.cookie",function(){}),define("app/user",["vendor/jquery.cookie","./EventManager","./util"],function(e,n,t){function a(){u(),p(),g(),$(".main-header .logo").on("click",h)}function i(){return x?x.id:0}function o(){return x}function r(){return x?x.name:""}function c(e){$.ajax({type:"get",url:"/api/auth/check",dataType:"json"}).done(function(n){var t=0==n.code;x=t?n.user:null,e&&e(t)})}function s(e,n){k=e;var a=t.dialog({selector:".login-dialog",onClosing:function(){k=null,l(!1)}});n=n||"account",$(".switch ."+n,a).click(),"account"==n&&$(".email",a).focus()}function u(){var e=$(".login-dialog"),n=$(".scan",e);$(".switch li",e).on("click",function(){var n=$(this),a=n.data("action"),i=$(".tab-"+a,e);t.toggleActive(i,"div"),t.toggleActive(n),"weixin"==a?l(!0):($(".email",e).focus(),l(!1))}),$(".login-btn",e).on("click",d),$(".qrcode",e).hover(function(t){e.is(":animated")||n.is(":animated")||n.addClass("active").css({left:160,opacity:0}).animate({left:340,opacity:1},400,"easeOutExpo")},function(t){e.is(":animated")||n.is(":animated")||n.animate({left:440,opacity:0},400,"easeOutExpo",function(){n.removeClass("active")})}),$("form",e).on("keyup",function(n){13==n.keyCode&&$(".tab-account",e).hasClass("active")&&$(".login-btn",e).trigger("click")})}function d(){var e=$(".login-dialog");$.ajax({type:"POST",url:"/api/auth/login",dataType:"json",data:{email:$(".email",e).val(),password:$(".password",e).val()}}).done(function(a){if(0==a.code)t.message(a.message),$(".x-dialog-close",e).click(),x=a.data,m(),f(),n.trigger("user","login");else if(1==a.code)x=a.data,m(),f();else{var i=$(".message",e);i.addClass("active").text(a.message).delay(2e3).queue(function(){i.removeClass("active").text("").dequeue()})}})}function l(e){if(clearInterval(y),e){var a=$(".login-dialog"),i=function(){var e=$(".qrcode-key",a).val();$.ajax({type:"POST",url:"/api/auth/login/weixin",data:{key:e},dataType:"json"}).done(function(e){0==e.code?(x=e.data,l(!1),$(".x-dialog-close",a).click(),t.message(e.message),m(),f(),n.trigger("user","login")):1==e.code&&(x=e.data,l(!1),m())})};y=setInterval(i,3e3)}}function f(){k&&k()}function p(){var e=$(".user-info"),n=$(".user-menu",e),t=function(){n.hide()};n.on("mouseleave",t),e.on("mouseleave",t),$(".wrap",e).on("mouseover",function(){n.show()}),$("ul > li",n).on("click",v),e.hasClass("active")&&$(".top-menu").css({"margin-right":e.width()})}function g(){var e=$(".copyright"),n=$.cookie("hideCopyright");n?e.remove():(e.addClass("active"),$(".close-btn",e).on("click",function(){e.fadeOut(function(){e.remove(),$.cookie("hideCopyright",!0)})}))}function v(e){var n=$(this),a=n.data("action");switch(a){case"share":t.message("敬请期待");break;case"setting":t.message("敬请期待");break;case"logout":window.location.href="/logout"}}function m(){var e=$(".user-info"),n=$(".top-menu");x?(e.addClass("active"),$(".photo img",e).attr("src",x.avatar_url),$(".name",e).text(x.name),n.css({"margin-right":e.width()})):(e.removeClass("active"),$(".name",e).text(""),$(".photo img",e).attr("src","#"),n.css({"margin-right":0}))}function h(e){c(function(e){e?t.message("你已登录"):s(null,"weixin")})}var x,y,k;return{init:a,getUserId:i,getUserInfo:o,getUserName:r,authCheck:c,showLoginDialog:s}}),define("app/ext/uploader",[],function(){function e(e,n){a=e,i=n,o=window.location.protocol+"//"+window.location.host}function n(e,n){var a=function(a){for(var r,c=0;c<a.length;c++){var s=a[c];if(s.displayName&&s.displayName.toLowerCase().indexOf("arduino")>-1){r=s;break}}return r?void t({action:"serial.connect",portPath:r.path,bitRate:i.bitRate},function(a){return a?void t({action:"upload",url:o+e+"/hex",delay:i.uploadDelay},function(e){t({action:"serial.disconnect",connectionId:a}),n(e?0:4)}):void n(3)}):void n(2)},r=!0,c=function(){t("serial.getDevices",function(e){return e&&0!=e.length?void a(e):void(r?(r=!1,setTimeout(c,1e3)):n(1))})};c()}function t(e,n){e="string"==typeof e?{action:e}:e,n=n||function(){},a.runtime.sendMessage(i.appId,e,n)}var a,i,o;return{init:e,upload:n}}),define("app/ext/agent",["../util","./uploader"],function(e,n){function t(e){u=e,d=o(),n.init(d,u);var t;t=-1!=navigator.userAgent.indexOf("WOW64")||-1!=navigator.userAgent.indexOf("Win64")?64:32;var a="/download/arduino-driver-x"+t+".zip";$(".arduino-driver-dialog .downloadUrl").attr("href",a)}function a(n){return i()&&d?void r(function(e){e?n():c()}):void e.message("啃萝卜扩展目前只支持Chrome浏览器，其它浏览器敬请期待！")}function i(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1}function o(){return i()?window.chrome:null}function r(e){d.runtime.sendMessage(u.appId,"ping",function(n){e(n&&"ping"==n.action&&"pong"==n.result?!0:!1)})}function c(){e.dialog(".install-dialog")}function s(e,t){a(function(){n.upload(e,t)})}var u,d;return{init:t,upload:s}}),define("app/project",["./EventManager","./util","./user","./ext/agent"],function(e,n,t,a){function i(){b=x();var e=angular.element(".ng-app").scope();e.$on("onRouteChange",m)}function o(){u()}function r(){t.authCheck(function(e){e?l():t.showLoginDialog()})}function c(){t.authCheck(function(e){e?p():t.showLoginDialog()})}function s(){t.authCheck(function(e){e?g():t.showLoginDialog()})}function u(){k(),j.resetProject(),d(x())}function d(e){if("string"==typeof e.project_data)try{e.project_data=JSON.parse(e.project_data)}catch(n){e.project_data={}}b=e,k(),j.setProject(b.project_data)}function l(){var e=b.id;return 0==e?void n.message("请先保存"):void v(e,!1,function(t){return 0!=t?void n.message("保存失败"):void $.ajax({type:"POST",url:"/api/project/build",dataType:"json",data:{id:e}}).done(function(e){return 0!=e.status?void n.message("编译失败"):void f(e.url)})})}function f(e){a.upload(e,function(e){switch(e){case 0:n.message("烧写成功");break;case 1:n.message("找不到串口");break;case 2:n.message("找不到arduino");break;case 3:n.message("连接arduino失败");break;case 4:default:n.message("烧写失败")}})}function p(){var e=b.id;0==e?g():v(e)}function g(){var e=n.dialog(".save-dialog"),t=$("form",e);$('input[name="name"]',t).val(b.project_name),$('textarea[name="intro"]',t).val(b.project_intro),$('input[name="public-type"][value="'+b.public_type+'"]',t).attr("checked",!0),$(".save-btn",t).off("click").on("click",function(){v(0)})}function v(e,a,i){a=0!=a;var o;if(0==e){var r=$(".save-dialog"),c=$("form",r),s=$('input[name="name"]',c).val();o={id:e,project_name:s,user_id:t.getUserId(),project_intro:$('textarea[name="intro"]',c).val(),project_data:JSON.stringify(y()),public_type:$("input[name='public-type']:checked",c).val()},$(".x-dialog-close",r).click()}else o={id:e,user_id:t.getUserId(),project_data:JSON.stringify(y())};$.ajax({type:"POST",url:"/api/project/save",data:o,dataType:"json"}).done(function(t){0==t.status&&0==e&&(b.id=t.data.project_id,b.project_name=o.project_name,b.project_intro=o.project_intro,b.public_type=o.public_type),a&&n.message(t.message),i&&i(t.status)})}function m(e,n){if(!C){C=!0;var a=n.hash||"";a=/^[0-9a-zA-Z]{6}$/.test(a)?a:"",t.authCheck(function(e){if(!e&&!a)return u(),void(C=!1);var n={};n.user_id=t.getUserId(),a?n.key=a:n.type="last",$.ajax({type:"POST",url:"/api/project/get",dataType:"json",data:n}).done(h)})}}function h(e){return C=!1,0!=e.status?(n.message(e.message),k(),void j.reload()):void d(e.data)}function x(){return{id:0,user_id:t.getUserId(),project_name:"我的项目",project_intro:"我的项目简介",public_type:1,project_data:{}}}function y(){return k(),j.getProject()}function k(){j||(j=angular.element("#api-controller").scope().getApi())}var j,b,C;return{init:i,create:o,save:c,edit:s,upload:r}}),define("app/topMenu",["./EventManager","./project"],function(e,n){function t(){$(".top-menu > ul > li,.sidebar > ul > li").on("click",a)}function a(e){var n=$(this),t=(n.index(),n.data("action"));switch(t){case"new":i();break;case"save":o();break;case"upload":r()}}function i(){n.create()}function o(){n.save()}function r(){n.upload()}return{init:t}}),define("app/config",[],function(){return{guide:{showIfFirstVisit:!0,autoNextDelay:3e3},extension:{appId:"hhgmonhbodfiplppmcangkmlfkcnilpd",uploadDelay:250,bitRate:115200}}}),define("app/app-index",["./EventManager","./util","./user","./project","./topMenu","./config","./ext/agent"],function(e,n,t,a,i,o,r){function c(){u(),s(),angular.bootstrap(".ng-app",["kenrobot"]),r.init(o.extension),t.init(),a.init(),i.init()}function s(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})}function u(){if(o.needPV){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?6518098de0bee39bef219952dbbae669";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}return{init:c}}),require.config({baseUrl:"/assets/js",shim:{"vendor/ace/theme-default":{deps:["./ace"]},"vendor/ace/mode-arduino":{deps:["./ace"]},"vendor/ace/snippets/text":{deps:["../ace"]},"vendor/ace/snippets/arduino":{deps:["../ace","./text"]},"vendor/ace/ext-language_tools":{deps:["./ace","./theme-default","./mode-arduino","./snippets/text","./snippets/arduino"]}}}),require(["./app/app-index"],function(e){e.init()}),define("index.js",function(){});