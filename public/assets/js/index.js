/*

  The MIT License (MIT)

  Copyright (c) 2007-2013 Einar Lielmanis and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>
  Parsing improvements for brace-less statements by Liam Newman <bitwiseman@gmail.com>


  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy        !jslint_happy
            ---------------------------------
            function ()         function()

            switch () {         switch() {
            case 1:               case 1:
              break;                break;
            }                   }

    space_after_anon_function (default false) - should the space before an anonymous function's parens be added, "function()" vs "function ()",
          NOTE: This option is overriden by jslint_happy (i.e. if jslint_happy is true, space_after_anon_function is true by design)

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "none"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line, or attempt to keep them where they are.

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    wrap_line_length (default unlimited) - lines should wrap at next opportunity after this number of characters.
          NOTE: This is not a hard limit. Lines will continue until a point where a newline would
                be preserved if it were present.

    end_with_newline (default false)  - end output with a newline


    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });

*/

// license. The Unicode regexps (for identifiers and whitespace) were

// if (a) if (b) if(c) d(); else e(); else f();

require(["./common"],function(){require(["../app/app-index"],function(e){e.init()})}),define("../index",function(){}),define("../app/config",[],function(){return{needPV:!0,buildAuth:!0,guide:{showIfFirstVisit:!0,autoNextDelay:3e3},extension:{appId:"hhgmonhbodfiplppmcangkmlfkcnilpd",launchAuth:!0,uploadDelay:250}}}),define("../app/EventManager",[],function(){function t(e,t){return e+"_"+t}function n(n,r,i){var s=t(n,r),o=e[s];o||(o=[],e[s]=o),o.push(i)}function r(n,r,i){var s=t(n,r),o=e[s];if(!o)return;for(var u=0;u<o.length;u++){var a=o[u];if(a==i){o.splice(u,1);break}}}function i(n,r,i){var s=t(n,r),o=e[s];if(!o)return;for(var u=0;u<o.length;u++){var a=o[u];a(i)}}var e={};return{bind:n,unbind:r,trigger:i}}),define("../app/nodeTemplate",["go","./EventManager"],function(e,t){function a(){var e=new go.Size(9,15),t=new go.Size(14,14),r=3,i={ArduinoUNO:n(go.Node,"Spot",f(),l(!1),c("0",new go.Spot(.947,.037),"Rectangle","#F1C933",e),c("1",new go.Spot(.912,.037),"Rectangle","#F1C933",e),c("2",new go.Spot(.877,.037),"Rectangle","#F1C933",e),c("3",new go.Spot(.842,.037),"Rectangle","#F1C933",e),c("4",new go.Spot(.807,.037),"Rectangle","#F1C933",e),c("5",new go.Spot(.772,.037),"Rectangle","#F1C933",e),c("6",new go.Spot(.737,.037),"Rectangle","#F1C933",e),c("7",new go.Spot(.702,.037),"Rectangle","#F1C933",e),c("8",new go.Spot(.653,.037),"Rectangle","#F1C933",e),c("9",new go.Spot(.618,.037),"Rectangle","#F1C933",e),c("10",new go.Spot(.583,.037),"Rectangle","#F1C933",e),c("11",new go.Spot(.548,.037),"Rectangle","#F1C933",e),c("12",new go.Spot(.513,.037),"Rectangle","#F1C933",e),c("13",new go.Spot(.478,.037),"Rectangle","#F1C933",e),c("A0",new go.Spot(.771,.984),"Rectangle","#F1C933",e),c("A1",new go.Spot(.806,.984),"Rectangle","#F1C933",e),c("A2",new go.Spot(.841,.984),"Rectangle","#F1C933",e),c("A3",new go.Spot(.876,.984),"Rectangle","#F1C933",e),c("A4",new go.Spot(.911,.984),"Rectangle","#F1C933",e),c("A5",new go.Spot(.946,.984),"Rectangle","#F1C933",e),c("SerialPort",new go.Spot(.0089,.248),"Rectangle","#F1C933",new go.Size(30,65))),"one-port-top":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,0,0,-r),null,"#F1C933",t,"#F19833")),"one-port-bottom":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,1,0,r),null,"#F1C933",t,"#F19833")),"one-port-right":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(1,.5,r,0),null,"#F1C933",t,"#F19833")),"two-port-top":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.333,0,0,-r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.667,0,0,-r),null,"#F1C933",t,"#F19833")),"two-port-bottom":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.333,1,0,r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.667,1,0,r),null,"#F1C933",t,"#F19833")),joystick:n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,0,0,-r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.333,1,0,r),null,"#F1C933",t,"#F19833"),c("P2",new go.Spot(.667,1,0,r),null,"#F1C933",t,"#F19833"))},s=n(go.Link,{routing:go.Link.AvoidsNodes,corner:5,click:d},(new go.Binding("points")).makeTwoWay(),n(go.Shape,{name:"LINE",isPanelMain:!0,fill:"#95a3ad",stroke:"#95a3ad",strokeWidth:3})),o=n(go.Adornment,"Auto",n(go.Shape,{fill:null,stroke:"#1ca8f8",strokeWidth:2}),n(go.Placeholder)),u=n(go.Adornment,"Link",n(go.Shape,{isPanelMain:!0,stroke:"#F19833",strokeWidth:0}));return{node:i,link:s,nodeSelection:o,linkSelection:u}}function f(){return[(new go.Binding("location","location",go.Point.parse)).makeTwoWay(go.Point.stringify),new go.Binding("selectable"),new go.Binding("deletable"),(new go.Binding("angle")).makeTwoWay(),{cursor:"pointer",locationSpot:go.Spot.Center,click:h,doubleClick:p,toolTip:n(go.Adornment,"Auto",n(go.Shape,{fill:"#F1C933",stroke:null}),n(go.TextBlock,{margin:10,font:r,stroke:"#69550B"},new go.Binding("text","label")))}]}function l(e){return e=e!=0,e?n(go.Panel,"Auto",n(go.Shape,"RoundedRectangle",{fill:"#d7d7d7",stroke:null}),n(go.Picture,new go.Binding("source"),new go.Binding("width"),new go.Binding("height"))):n(go.Picture,new go.Binding("source"),new go.Binding("width"),new go.Binding("height"))}function c(e,t,i,s,o,u){return n(go.Shape,i||"Circle",{name:"PORT",fromLinkable:!0,toLinkable:!0,portId:e,alignment:t,alignmentFocus:t,fill:s||"transparent",desiredSize:o||new go.Size(5,5),stroke:u||null,cursor:"crosshair",click:v,mouseEnter:m,mouseLeave:g,toolTip:n(go.Adornment,"Auto",n(go.Shape,{fill:"#F1C933",stroke:null}),n(go.TextBlock,{margin:10,font:r,stroke:"#69550B"},new go.Binding("text","",function(t){var n=t.ports,r=n[e];return t.type=="component"||r.type==3?r.label:"Pin "+r.label})))})}function h(e,n){t.trigger("hardware","nodeClick",n),e.handled=!0}function p(e,n){n.data.type=="board"&&t.trigger("project","switchPanel",1)}function d(e,n){t.trigger("hardware","linkClick",n),e.handled=!0}function v(e,n){t.trigger("hardware","portClick",n),e.handled=!0}function m(e,t){o=t.fill,t.fill=u}function g(e,t){t.fill=o}var n=go.GraphObject.make,r="14px Microsoft Yahei",i="#F1C933",s="#F19833",o="#ffe42b",u="#F19833";return a()}),define("../app/util",["jquery"],function(e){function t(t){var n=400;e("div.x-message").stop(!0).fadeOut(n/2,function(){e(this).remove()}),t=typeof t=="string"?{text:t}:t;var r=t.type||"info",i=t.text,s='<div class="x-message alert alert-'+r+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+i+"</div>",o=e(s);o.appendTo(e("body")).css({left:(e(window).width()-o.width())/2,top:-o.height()}).animate({top:150},n,"swing").delay(2e3).fadeOut(n,function(){e(this).remove()})}function n(t){t=typeof t=="string"?{text:t}:t;var n=t.type||"confirm",r=t.title;r||(r=n=="confirm"?"确认":"信息提示");var i=t.text,s=t.ok||"确 认",o=t.cancel||"取 消",u=t.okFunc,a=t.cancelFunc,f=t.closeFunc,l="";n=="confirm"?l='<div class="x-dialog-btns"><button class="x-dialog-btn cancel">'+o+'</button><button class="x-dialog-btn confirm">'+s+"</button></div>":n=="info"&&(l='<div class="x-dialog-btns"><button class="x-dialog-btn confirm">'+s+"</button></div>");var c='<div class="x-dialog x-dialog-'+n+'">			<div class="x-dialog-title">'+r+'</div>			<div class="x-dialog-close">&times;</div>			<div class="x-dialog-content">'+i+"</div>"+l+"</div>",h=e(c);t.cls&&h.addClass(t.cls),t.contentCls&&e(".x-dialog-content",h).addClass(t.contentCls);var p=function(){h.slideUp(200,function(){h.remove(),e(".dialog-layer").removeClass("active"),f&&f()})};return e(".x-dialog-btns .confirm",h).on("click",function(){p(),u&&u()}),e(".x-dialog-close,.x-dialog-btns .cancel",h).on("click",function(){p(),a&&a()}),h.appendTo(e(".dialog-layer").addClass("active")).css({top:-h.height()}).show().animate({top:200},400,"swing"),h}function r(t){t=typeof t=="string"?{selector:t}:t;var n=t.selector,r=e(n);if(!r||!r.hasClass("x-dialog"))return console.log("Can not find "+n+" or it is not a x-dialog"),!1;var i=t.okFunc,s=t.cancelFunc,o=t.closeFunc,u=e(".dialog-layer").addClass("active"),a=function(){r.slideUp(200,function(){r.hide(),u.removeClass("active"),o&&o()})};return e(".x-dialog-btns .confirm",r).off("click").on("click",function(){a(),i&&i()}),e(".x-dialog-close,.x-dialog-btns .cancel",r).off("click").on("click",function(){a(),s&&s()}),r.css({top:-r.height()}).show().animate({top:200},300,"swing"),r}function i(e,t,n){return t=t||"li",n?e.hasClass("active")?(e.removeClass("active"),!1):(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0):e.hasClass("active")?!1:(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0)}return{message:t,dialog:r,toggleActive:i}}),define("../app/hardware",["jquery","jquery-ui","jquery.cookie","go","./nodeTemplate","./EventManager","./util"],function(e,t,t,t,n,r,i){function y(){u=go.GraphObject.make,a=u(go.Diagram,c,{initialContentAlignment:go.Spot.Center,allowClipboard:!1,allowCopy:!1,allowTextEdit:!1,allowReshape:!1,allowRelink:!1,allowLink:!0,maxSelectionCount:1,"toolManager.hoverDelay":500,"clickCreatingTool.isEnabled":!1,"clickCreatingTool.isDoubleClick":!1,"linkingTool.portGravity":50,"linkingTool.linkValidation":Z,"relinkingTool.linkValidation":Z,"grid.visible":!0,"toolManager.mouseWheelBehavior":go.ToolManager.WheelZoom,"dragSelectingTool.isEnabled":!1,"animationManager.isEnabled":!1,click:V,doubleClick:$,contextClick:J,PartCreated:K}),a.grid=u(go.Panel,"Grid",u(go.Shape,"LineH",{stroke:"#EBEFF7"}),u(go.Shape,"LineV",{stroke:"#EBEFF7"}),u(go.Shape,"LineH",{stroke:"#F0F3F8",interval:5}),u(go.Shape,"LineV",{stroke:"#F0F3F8",interval:5}));for(var e in n.node){var t=n.node[e];a.nodeTemplateMap.add(e=="default"?"":e,t)}a.linkTemplate=n.link,a.nodeSelectionAdornmentTemplate=n.nodeSelection,a.linkSelectionAdornmentTemplate=n.linkSelection,a.toolManager.linkingTool.temporaryLink=u(go.Link,u(go.Shape,{stroke:"#95a3ad",strokeWidth:2}));var r=u(go.Node,u(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));a.toolManager.linkingTool.temporaryFromNode=r,a.toolManager.linkingTool.temporaryFromPort=r.port;var i=u(go.Node,u(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));a.toolManager.linkingTool.temporaryToNode=i,a.toolManager.linkingTool.temporaryToPort=i.port;var s=a.toolManager.clickCreatingTool;s.insertPart=function(e){return this.archetypeNodeData=R(this.archetypeNodeData.name),go.ClickCreatingTool.prototype.insertPart.call(this,e)},s=a.toolManager.linkingTool,s.doActivate=function(){var e=this.findLinkablePort();return j(e),go.LinkingTool.prototype.doActivate.call(this)},s.doDeactivate=function(){var e=go.LinkingTool.prototype.doDeactivate.call(this);return j(),e};var o=u(go.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort"});a.model=o,g={},N(),k(p)}function b(e){f=e}function w(){var e=[],t=a.model.nodeDataArray,n;for(var r=0;r<t.length;r++)n=t[r],e.push({type:n.type,name:n.name,key:n.key,varName:n.varName||"",location:n.location});var i=[],s=a.model.linkDataArray,o,u,f,l;for(var r=0;r<s.length;r++){o=s[r],u=[],f=o.points.toArray();for(var c=0;c<f.length;c++)l=f[c],u.push(l.x,l.y);i.push({from:o.from,to:o.to,fromPort:o.fromPort,toPort:o.toPort,points:u})}return{model:{nodeDataArray:e,linkDataArray:i},componentConuts:componentConuts}}function E(t){t=t||{};var n=t.model;if(n){typeof n=="string"&&(n=JSON.parse(n));var r=n.nodeDataArray,i,s,o;for(var f=0;f<r.length;f++)i=r[f],o=i.varName||"",s=q(i.name,f==0),i=e.extend(i,s),i.varName=o;a.model=u(go.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:n.nodeDataArray,linkDataArray:n.linkDataArray})}else a.clear(),D();componentConuts=t.componentConuts||[],j(),F(),I(!1)}function S(){return p}function x(e){if(p!="modern")return;var t=a.toolManager.clickCreatingTool;t.isEnabled=!0,t.archetypeNodeData={name:e};var n=q(e);h.attr("src",n.source).css({width:n.width,height:n.height,left:-999}),L()}function T(){var e=[],t=B(),n=t.findNodesConnected().iterator,r,i,s,o,u,a;while(n.next()){r=n.value,i=r.data,s=[],u=t.findLinksBetween(r).iterator;while(u.next())o=u.value,a=o.fromPort.part.data.type,a=="board"?s.push({source:o.toPort.portId,target:o.fromPort.portId}):s.push({source:o.fromPort.portId,target:o.toPort.portId});e.push({name:i.name,headCode:i.headCode,varCode:i.varCode,setupCode:i.setupCode,varName:i.varName,ports:s})}return e.sort(function(e,t){var n=e.name.localeCompare(t.name);return n==0?e.varName.localeCompare(t.varName):n})}function N(){l=e("#"+c).droppable({disabled:!0,scope:"hardware",drop:et}),h=e(".hardware .follow .follower"),e(".hardware .tools .interactive-mode > li").on("click",_),e(".hardware .tools .mode > li").on("click",M),r.bind("hardware","nodeClick",Q),r.bind("hardware","linkClick",G),r.bind("hardware","portClick",Y)}function C(t){e('.hardware .tools .mode li[data-mode="'+t+'"').click()}function k(t){t=="drag"?e('.hardware .tools .interactive-mode li[data-mode="modern"]').click():e('.hardware .tools .interactive-mode li[data-mode="drag"]').click()}function L(e){l.off("mousemove",A),h.css({left:-999});if(p!="modern"||d!="default"&&d!="clone")return;if(e===undefined&&!a.toolManager.clickCreatingTool.isEnabled)return;if(e==0){a.toolManager.clickCreatingTool.isEnabled=!1;return}l.on("mousemove",A),l.off("mouseout").on("mouseout",O)}function A(e){h.css({top:e.offsetY-h.height()/2,left:e.offsetX-h.width()/2})}function O(e){h.css({left:-999})}function M(t){var n=e(this);i.toggleActive(n),d=n.data("mode");var r=a.toolManager.clickCreatingTool,s=p=="modern";switch(d){case"default":r.isEnabled=s;break;case"clone":r.isEnabled=s;break;case"delete":r.isEnabled=!1}L()}function _(t,n){var i=e(this).addClass("hide"),s=i.data("mode"),o=e('.hardware .tools .mode li[data-mode="clone"]');s=="drag"?(p="modern",i.parent().find('li[data-mode="'+p+'"]').removeClass("hide"),o.removeClass("hide")):(p="drag",i.parent().find('li[data-mode="'+p+'"]').removeClass("hide"),o.addClass("hide")),l.droppable("option","disabled",p!="drag"),C("default"),e.cookie("interactiveMode",p),r.trigger("hardware","changeInteractiveMode",p)}function D(){P("ArduinoUNO",0,0,!0)}function P(e,t,n,r){var i=R(e,r);typeof t=="number"&&typeof n=="number"&&(i.location=t+" "+n);var s=a.model;return s.addNodeData(i),i}function H(e,t,n,r){var i={from:e,to:t,fromPort:n,toPort:r},s=a.model;return s.addLinkData(i),i}function B(){var e=a.nodes.iterator,t;while(e.next()){t=e.value;if(t.data.type=="board")return t}}function j(e){var t=B();if(!t)return;var n=t.ports.iterator,r;while(n.next())r=n.value,X(r)?r.fill="#4891ed":r.fill="#ffe42b";v&&v.diagram&&(v.fill="#F1C933"),v=e;if(v){v.fill="#F19833";var i=v.part.data.type;if(i=="component"){n.reset();while(n.next()){r=n.value;if(X(r)||!W(v,r))r.fill="#4891ed"}}}}function F(e){m&&m.diagram&&(m.fromPort.fill="#F1C933",m.toPort.fill="#4891ed"),m=e,m&&(m.fromPort.fill="#F19833",m.toPort.fill="#F19833")}function I(t){var n=e(".hardware .name-dialog");if(t){var r=e(".name",n).val(t.varName).off("blur").on("blur",function(e){var n=tt(t.key,r.val());n.success||(r.val(t.varName),i.message(n.message))});if(n.css("display")=="block"){var s=tt(t.key,r.val());s.success||(r.val(t.varName),i.message(s.message))}n.show()}else n.hide()}function q(e,t){return t?f.boards[e]:f.components[e]}function R(t,n){var r=q(t,n),i=e.extend({},r),s=(new Date).getTime();i.key=t+"_"+s;var o=g[t]||0;return i.varName+=o,o++,g[t]=o,i}function U(e){var t=e.part,n=t.data.ports;return n[e.portId]}function z(e){var t=e.part,n=t.findLinksConnected(e.portId).iterator;return n.next(),n.value}function W(e,t){var n=U(e),r=U(t);if(n.type!=r.type)return!1;var i,s;n.owner_type==0?(i=n,s=r):(i=r,s=n);if(i.special=="")return!0;var o=i.special.split(",");return o.indexOf(s.name)>=0}function X(e){var t=e.part;return t.findLinksConnected(e.portId).count>0}function V(e){j(),F(),I(!1)}function $(e){r.trigger("project","switchPanel",1)}function J(e){C("default"),L(!1)}function K(e){d=="default"&&(a.toolManager.clickCreatingTool.isEnabled=!1),L()}function Q(e){j(),F();if(d=="default"){var t=e.data,n=t.type;n=="component"?I({varName:t.varName,key:t.key}):I(!1)}else d=="delete"?(I(!1),e.deletable&&a.remove(e)):I(!1)}function G(e){j(),I(!1),d=="delete"?(e==m&&(F(),m=null),a.remove(e)):(d=="default"||d=="clone")&&F(e)}function Y(e){F(),I(!1);if(p=="modern"&&d=="default"){var t=e.part,n=t.data.type;if(!v)j(e);else{var r=v.part.data.type;if(r=="component")if(n=="component"){if(!X(v)||X(e)){j();return}var i=z(v),s=i.getOtherPort(v);if(!W(e,s)){j();return}a.remove(i);var o=s.part.data.key,u=e.part.data.key;H(o,u,s.portId,e.portId),j()}else{if(X(v)||X(e)||!W(v,e)){j();return}var o=v.part.data.key,u=e.part.data.key;H(o,u,v.portId,e.portId),j()}else if(n=="component"){if(X(v)||X(e)||!W(v,e)){j();return}var o=v.part.data.key,u=e.part.data.key;H(o,u,v.portId,e.portId),j()}else{if(!X(v)||X(e)){j();return}var i=z(v),s=i.getOtherPort(v);if(!W(e,s)){j();return}a.remove(i);var o=s.part.data.key,u=e.part.data.key;H(o,u,s.portId,e.portId),j()}}}else j()}function Z(e,t,n,r){return!X(t)&&!X(r)&&W(t,r)}function et(t,n){var r=n.helper.first(),i=r.data("component-name"),s=r.width(),o=r.height(),u=r.offset().left+s/2,f=r.offset().top+o/2,l=q(i);switch(l.category){case"one-port-top":case"two-port-top":f-=3.5;break;case"one-port-bottom":case"two-port-bottom":f+=3.5;break;case"one-port-right":u+=3.5}var c=e(a.div).offset(),h=new go.Point(u-c.left,f-c.top);h=a.transformViewToDoc(h),P(i,h.x,h.y)}function tt(e,t){if(t=="")return{message:"变量名不能为空",success:!1};if(s.indexOf(t)>=0)return{message:"变量名不能是关键字",success:!1};if(!o.test(t))return{message:"变量名只能由字母、数字或下划线组成，且不能以数字开头",success:!1};var n=a.model.nodeDataArray;for(var r=0;r<n.length;r++){var i=n[r];if(i.key!=e&&i.name==t)return{message:"变量名重复",success:!1}}var i=a.model.findNodeDataForKey(e);return i?(i.varName=t,{success:!0}):{message:"非法操作",success:!0}}var s=["asm","do","if","return","typedef","auto","double","inline","short","typeid","bool","dynamic_cast","int","signed","typename","break","else","long","sizeof","union","case","enum","mutable","static","unsigned","catch","explicit","namespace","static_cast","using","char","export","new","struct","virtual","class","extern","operator","switch","void","const","false","private","template","volatile","const_cast","float","protected","this","wchar_t","continue","for","public","throw","while","default","friend","register","true","delete","goto","reinterpret_cast","try","_Bool","_Complex","_Imaginary"],o=/^[_a-zA-Z][_a-zA-Z0-9]*$/,u,a,f,l,c="hardware-container",h,p=e.cookie("interactiveMode")||"modern",d="default",v,m,g;return{init:y,load:b,getData:w,setData:E,getInteractiveMode:S,setPlaceComponent:x,getNodes:T}}),define("../app/user",["jquery","./EventManager","./util"],function(e,t,n){function s(){l(),c()}function o(){return r?r.id:0}function u(){return r}function a(t){e.ajax({type:"GET",url:"/auth/check",dataType:"json"}).done(function(e){var n=e.code==0;r=n?e.user:null,t&&t(n)})}function f(t,i){var s=e("#login_dialog");e(".qrLoginBtn, .baseLoginBtn",s).off("click").on("click",function(n){var r=e(this).data("action");r=="qrLogin"?(e(".qrLoginBtn, .qrLogin").removeClass("active"),e(".baseLoginBtn, .baseLogin").addClass("active"),e(".qrLoginBtn").css({display:"none"}),e(".baseLoginBtn").css({display:"block"}),e("#use_weixin").removeClass("active"),h(!1)):(e(".baseLoginBtn, .baseLogin").removeClass("active"),e(".qrLoginBtn, .qrLogin").addClass("active"),e(".baseLoginBtn").css({display:"none"}),e(".qrLoginBtn").css({display:"block"}),h(!0,t))}),e(".btn-login",s).off("click").on("click",function(){e.ajax({type:"POST",url:"/snspostlogin",dataType:"json",data:{email:e(".email",s).val(),password:e(".password",s).val()}}).done(function(i){i.code==0?(n.message(i.message),e("#login_dialog .close-btn").click(),r=i.data,p(),t&&t()):i.code==1?(r=i.data,p(),t&&t()):e(".baseLogin .message span").show().html(i.message).delay(2e3).queue(function(){e(this).fadeOut().dequeue()})})}),i=i||0,i==0?e(".qrLoginBtn").click():e(".baseLoginBtn").click(),s.css({top:-s.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function l(){var t=e("#login_dialog"),n=e("#use_weixin");e(".close-btn",t).on("click",function(r){t.slideUp(100,function(t,r){n.removeClass("active"),e(".dialog-layer").removeClass("active")}),h(!1)}),e(".qrLogin .qrcode").hover(function(t){var r=e(this).offset().top,i=e(this).offset().left;n.is(":animated")||n.addClass("active").show().css({top:r-160,left:i+50,opacity:0}).animate({left:i+260,opacity:1})},function(t){var r=e(this).offset().left;n.is(":animated")||n.animate({left:r+420,opacity:0},null,null,function(){n.removeClass("active").hide()})}),e("form",t).on("keyup",function(n){n.keyCode==13&&e(".baseLogin",t).hasClass("active")&&e(".btn-login",t).trigger("click")})}function c(){var t=e(".user"),n=e(".dialog",t),r=e(".indent",t),i=e(".software .back");e(".close-btn",n).on("click",function(){n.slideUp(200,function(e){r.show()}),i.removeClass("active")}),r.on("click",function(){n.slideDown(400,function(){r.hide()}),i.addClass("active")})}function h(s,o){clearInterval(i),s&&(i=setInterval(function(){var i=e("#qrcode_key").val();e.ajax({url:"/weixinlogin?key="+i,dataType:"json"}).done(function(i){i.code==0?(r=i.data,h(!1),n.message(i.message),e("#login_dialog .close-btn").click(),p(),o&&o(),t.trigger("user","login")):i.code==1&&(r=i.data,h(!1),p())})},3e3))}function p(){var t=e(".user"),n=e(".software .back");r?(t.addClass("active"),n.addClass("active"),e(".photo img",t).attr("src",r.avatar_url),e(".name",t).text(r.name)):(t.removeClass("active"),n.removeClass("active"),e(".name",t).text(""),e(".photo img",t).attr("src","#"))}var r,i;return{init:s,getUserId:o,getUserInfo:u,authCheck:a,showLoginDialog:f}}),function(){function t(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function n(e){return e.replace(/^\s+|\s+$/g,"")}function r(e){return e.replace(/^\s+/g,"")}function i(e){return e.replace(/\s+$/g,"")}function s(e,t){"use strict";var n=new u(e,t);return n.beautify()}function u(i,s){"use strict";function T(e,t){var n=0;e&&(n=e.indentation_level,!u.just_added_newline()&&e.line_indent_level>n&&(n=e.line_indent_level));var r={mode:t,parent:e,last_text:e?e.last_text:"",last_word:e?e.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:n,line_indent_level:e?e.line_indent_level:n,start_line_index:u.get_line_number(),ternary_depth:0};return r}function C(e){var t=e.newlines,n=S.keep_array_indentation&&H(g.mode);if(n)for(r=0;r<t;r+=1)A(r>0);else{S.max_preserve_newlines&&t>S.max_preserve_newlines&&(t=S.max_preserve_newlines);if(S.preserve_newlines&&e.newlines>1){A();for(var r=1;r<t;r+=1)A(!0)}}p=e,E[p.type]()}function k(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function L(e){e=e===undefined?!1:e;if(u.just_added_newline())return;if(S.preserve_newlines&&p.wanted_newline||e)A(!1,!0);else if(S.wrap_line_length){var t=u.current_line.get_character_count()+p.text.length+(u.space_before_token?1:0);t>=S.wrap_line_length&&A(!1,!0)}}function A(e,t){if(!t&&g.last_text!==";"&&g.last_text!==","&&g.last_text!=="="&&d!=="TK_OPERATOR")while(g.mode===o.Statement&&!g.if_block&&!g.do_block)j();u.add_new_line(e)&&(g.multiline_frame=!0)}function O(){u.just_added_newline()&&(S.keep_array_indentation&&H(g.mode)&&p.wanted_newline?(u.current_line.push(p.whitespace_before),u.space_before_token=!1):u.set_indent(g.indentation_level)&&(g.line_indent_level=g.indentation_level))}function M(e){if(u.raw){u.add_raw_token(p);return}S.comma_first&&d==="TK_COMMA"&&u.just_added_newline()&&u.previous_line.last()===","&&(u.previous_line.pop(),O(),u.add_token(","),u.space_before_token=!0),e=e||p.text,O(),u.add_token(e)}function _(){g.indentation_level+=1}function D(){g.indentation_level>0&&(!g.parent||g.indentation_level>g.parent.indentation_level)&&(g.indentation_level-=1)}function P(e){g?(b.push(g),y=g):y=T(null,e),g=T(y,e)}function H(e){return e===o.ArrayLiteral}function B(e){return t(e,[o.Expression,o.ForInitializer,o.Conditional])}function j(){b.length>0&&(y=g,g=b.pop(),y.mode===o.Statement&&u.remove_redundant_indentation(y))}function F(){return g.parent.mode===o.ObjectLiteral&&g.mode===o.Statement&&(g.last_text===":"&&g.ternary_depth===0||d==="TK_RESERVED"&&t(g.last_text,["get","set"]))}function I(){return d==="TK_RESERVED"&&t(g.last_text,["var","let","const"])&&p.type==="TK_WORD"||d==="TK_RESERVED"&&g.last_text==="do"||d==="TK_RESERVED"&&g.last_text==="return"&&!p.wanted_newline||d==="TK_RESERVED"&&g.last_text==="else"&&(p.type!=="TK_RESERVED"||p.text!=="if")||d==="TK_END_EXPR"&&(y.mode===o.ForInitializer||y.mode===o.Conditional)||d==="TK_WORD"&&g.mode===o.BlockStatement&&!g.in_case&&p.text!=="--"&&p.text!=="++"&&v!=="function"&&p.type!=="TK_WORD"&&p.type!=="TK_RESERVED"||g.mode===o.ObjectLiteral&&(g.last_text===":"&&g.ternary_depth===0||d==="TK_RESERVED"&&t(g.last_text,["get","set"]))?(P(o.Statement),_(),d==="TK_RESERVED"&&t(g.last_text,["var","let","const"])&&p.type==="TK_WORD"&&(g.declaration_statement=!0),F()||L(p.type==="TK_RESERVED"&&t(p.text,["do","for","if","while"])),!0):!1}function q(e,t){for(var r=0;r<e.length;r++){var i=n(e[r]);if(i.charAt(0)!==t)return!1}return!0}function R(e,t){var n=0,r=e.length,i;for(;n<r;n++){i=e[n];if(i&&i.indexOf(t)!==0)return!1}return!0}function U(e){return t(e,["case","return","do","if","throw","else"])}function z(e){var t=l+(e||0);return t<0||t>=a.length?null:a[t]}function W(){I();var e=o.Expression;if(p.text==="["){if(d==="TK_WORD"||g.last_text===")"){d==="TK_RESERVED"&&t(g.last_text,h.line_starters)&&(u.space_before_token=!0),P(e),M(),_(),S.space_in_paren&&(u.space_before_token=!0);return}e=o.ArrayLiteral,H(g.mode)&&(g.last_text==="["||g.last_text===","&&(v==="]"||v==="}"))&&(S.keep_array_indentation||A())}else d==="TK_RESERVED"&&g.last_text==="for"?e=o.ForInitializer:d==="TK_RESERVED"&&t(g.last_text,["if","while"])&&(e=o.Conditional);g.last_text===";"||d==="TK_START_BLOCK"?A():d==="TK_END_EXPR"||d==="TK_START_EXPR"||d==="TK_END_BLOCK"||g.last_text==="."?L(p.wanted_newline):d==="TK_RESERVED"&&p.text==="("||d==="TK_WORD"||d==="TK_OPERATOR"?d==="TK_RESERVED"&&(g.last_word==="function"||g.last_word==="typeof")||g.last_text==="*"&&v==="function"?S.space_after_anon_function&&(u.space_before_token=!0):d==="TK_RESERVED"&&(t(g.last_text,h.line_starters)||g.last_text==="catch")&&S.space_before_conditional&&(u.space_before_token=!0):u.space_before_token=!0,p.text==="("&&d==="TK_RESERVED"&&g.last_word==="await"&&(u.space_before_token=!0),p.text==="("&&(d==="TK_EQUALS"||d==="TK_OPERATOR")&&(F()||L()),p.text==="("&&d!=="TK_WORD"&&d!=="TK_RESERVED"&&L(),P(e),M(),S.space_in_paren&&(u.space_before_token=!0),_()}function X(){while(g.mode===o.Statement)j();g.multiline_frame&&L(p.text==="]"&&H(g.mode)&&!S.keep_array_indentation),S.space_in_paren&&(d==="TK_START_EXPR"&&!S.space_in_empty_paren?(u.trim(),u.space_before_token=!1):u.space_before_token=!0),p.text==="]"&&S.keep_array_indentation?(M(),j()):(j(),M()),u.remove_redundant_indentation(y),g.do_while&&y.mode===o.Conditional&&(y.mode=o.Expression,g.do_block=!1,g.do_while=!1)}function V(){var e=z(1),n=z(2);n&&(t(n.text,[":",","])&&t(e.type,["TK_STRING","TK_WORD","TK_RESERVED"])||t(e.text,["get","set"])&&t(n.type,["TK_WORD","TK_RESERVED"]))?t(v,["class","interface"])?P(o.BlockStatement):P(o.ObjectLiteral):t(d,["TK_EQUALS","TK_START_EXPR","TK_COMMA","TK_OPERATOR"])||d==="TK_RESERVED"&&t(g.last_text,["return","throw"])?P(o.ObjectLiteral):P(o.BlockStatement);var r=!e.comments_before.length&&e.text==="}",i=r&&g.last_word==="function"&&d==="TK_END_EXPR";S.brace_style==="expand"||S.brace_style==="none"&&p.wanted_newline?d!=="TK_OPERATOR"&&(i||d==="TK_EQUALS"||d==="TK_RESERVED"&&U(g.last_text)&&g.last_text!=="else")?u.space_before_token=!0:A(!1,!0):d!=="TK_OPERATOR"&&d!=="TK_START_EXPR"?d==="TK_START_BLOCK"?A():u.space_before_token=!0:H(y.mode)&&g.last_text===","&&(v==="}"?u.space_before_token=!0:A()),M(),_()}function $(){while(g.mode===o.Statement)j();var e=d==="TK_START_BLOCK";S.brace_style==="expand"?e||A():e||(H(g.mode)&&S.keep_array_indentation?(S.keep_array_indentation=!1,A(),S.keep_array_indentation=!0):A()),j(),M()}function J(){p.type==="TK_RESERVED"&&g.mode!==o.ObjectLiteral&&t(p.text,["set","get"])&&(p.type="TK_WORD");if(p.type==="TK_RESERVED"&&g.mode===o.ObjectLiteral){var e=z(1);e.text==":"&&(p.type="TK_WORD")}I()||p.wanted_newline&&!B(g.mode)&&(d!=="TK_OPERATOR"||g.last_text==="--"||g.last_text==="++")&&d!=="TK_EQUALS"&&(S.preserve_newlines||d!=="TK_RESERVED"||!t(g.last_text,["var","let","const","set","get"]))&&A();if(g.do_block&&!g.do_while){if(p.type==="TK_RESERVED"&&p.text==="while"){u.space_before_token=!0,M(),u.space_before_token=!0,g.do_while=!0;return}A(),g.do_block=!1}if(g.if_block)if(!g.else_block&&p.type==="TK_RESERVED"&&p.text==="else")g.else_block=!0;else{while(g.mode===o.Statement)j();g.if_block=!1,g.else_block=!1}if(p.type==="TK_RESERVED"&&(p.text==="case"||p.text==="default"&&g.in_case_statement)){A();if(g.case_body||S.jslint_happy)D(),g.case_body=!1;M(),g.in_case=!0,g.in_case_statement=!0;return}p.type==="TK_RESERVED"&&p.text==="function"&&((t(g.last_text,["}",";"])||u.just_added_newline()&&!t(g.last_text,["[","{",":","=",","]))&&!u.just_added_blankline()&&!p.comments_before.length&&(A(),A(!0)),d==="TK_RESERVED"||d==="TK_WORD"?d==="TK_RESERVED"&&t(g.last_text,["get","set","new","return","export","async"])?u.space_before_token=!0:d==="TK_RESERVED"&&g.last_text==="default"&&v==="export"?u.space_before_token=!0:A():d==="TK_OPERATOR"||g.last_text==="="?u.space_before_token=!0:(!!g.multiline_frame||!B(g.mode)&&!H(g.mode))&&A());if(d==="TK_COMMA"||d==="TK_START_EXPR"||d==="TK_EQUALS"||d==="TK_OPERATOR")F()||L();if(p.type==="TK_RESERVED"&&t(p.text,["function","get","set"])){M(),g.last_word=p.text;return}w="NONE",d==="TK_END_BLOCK"?p.type!=="TK_RESERVED"||!t(p.text,["else","catch","finally"])?w="NEWLINE":S.brace_style==="expand"||S.brace_style==="end-expand"||S.brace_style==="none"&&p.wanted_newline?w="NEWLINE":(w="SPACE",u.space_before_token=!0):d==="TK_SEMICOLON"&&g.mode===o.BlockStatement?w="NEWLINE":d==="TK_SEMICOLON"&&B(g.mode)?w="SPACE":d==="TK_STRING"?w="NEWLINE":d==="TK_RESERVED"||d==="TK_WORD"||g.last_text==="*"&&v==="function"?w="SPACE":d==="TK_START_BLOCK"?w="NEWLINE":d==="TK_END_EXPR"&&(u.space_before_token=!0,w="NEWLINE"),p.type==="TK_RESERVED"&&t(p.text,h.line_starters)&&g.last_text!==")"&&(g.last_text==="else"||g.last_text==="export"?w="SPACE":w="NEWLINE");if(p.type==="TK_RESERVED"&&t(p.text,["else","catch","finally"]))if(d!=="TK_END_BLOCK"||S.brace_style==="expand"||S.brace_style==="end-expand"||S.brace_style==="none"&&p.wanted_newline)A();else{u.trim(!0);var n=u.current_line;n.last()!=="}"&&A(),u.space_before_token=!0}else w==="NEWLINE"?d==="TK_RESERVED"&&U(g.last_text)?u.space_before_token=!0:d!=="TK_END_EXPR"?(d!=="TK_START_EXPR"||p.type!=="TK_RESERVED"||!t(p.text,["var","let","const"]))&&g.last_text!==":"&&(p.type==="TK_RESERVED"&&p.text==="if"&&g.last_text==="else"?u.space_before_token=!0:A()):p.type==="TK_RESERVED"&&t(p.text,h.line_starters)&&g.last_text!==")"&&A():g.multiline_frame&&H(g.mode)&&g.last_text===","&&v==="}"?A():w==="SPACE"&&(u.space_before_token=!0);M(),g.last_word=p.text,p.type==="TK_RESERVED"&&p.text==="do"&&(g.do_block=!0),p.type==="TK_RESERVED"&&p.text==="if"&&(g.if_block=!0)}function K(){I()&&(u.space_before_token=!1);while(g.mode===o.Statement&&!g.if_block&&!g.do_block)j();M()}function Q(){I()?u.space_before_token=!0:d==="TK_RESERVED"||d==="TK_WORD"?u.space_before_token=!0:d==="TK_COMMA"||d==="TK_START_EXPR"||d==="TK_EQUALS"||d==="TK_OPERATOR"?F()||L():A(),M()}function G(){I(),g.declaration_statement&&(g.declaration_assignment=!0),u.space_before_token=!0,M(),u.space_before_token=!0}function Y(){if(g.declaration_statement){B(g.parent.mode)&&(g.declaration_assignment=!1),M(),g.declaration_assignment?(g.declaration_assignment=!1,A(!1,!0)):(u.space_before_token=!0,S.comma_first&&L());return}M(),g.mode===o.ObjectLiteral||g.mode===o.Statement&&g.parent.mode===o.ObjectLiteral?(g.mode===o.Statement&&j(),A()):(u.space_before_token=!0,S.comma_first&&L())}function Z(){I();if(d==="TK_RESERVED"&&U(g.last_text)){u.space_before_token=!0,M();return}if(p.text==="*"&&d==="TK_DOT"){M();return}if(p.text===":"&&g.in_case){g.case_body=!0,_(),M(),A(),g.in_case=!1;return}if(p.text==="::"){M();return}d==="TK_OPERATOR"&&L();var e=!0,n=!0;t(p.text,["--","++","!","~"])||t(p.text,["-","+"])&&(t(d,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||t(g.last_text,h.line_starters)||g.last_text===",")?(e=!1,n=!1,p.wanted_newline&&(p.text==="--"||p.text==="++")&&A(!1,!0),g.last_text===";"&&B(g.mode)&&(e=!0),d==="TK_RESERVED"?e=!0:d==="TK_END_EXPR"?e=g.last_text!=="]"||p.text!=="--"&&p.text!=="++":d==="TK_OPERATOR"&&(e=t(p.text,["--","-","++","+"])&&t(g.last_text,["--","-","++","+"]),t(p.text,["+","-"])&&t(g.last_text,["--","++"])&&(n=!0)),(g.mode===o.BlockStatement||g.mode===o.Statement)&&(g.last_text==="{"||g.last_text===";")&&A()):p.text===":"?g.ternary_depth===0?e=!1:g.ternary_depth-=1:p.text==="?"?g.ternary_depth+=1:p.text==="*"&&d==="TK_RESERVED"&&g.last_text==="function"&&(e=!1,n=!1),u.space_before_token=u.space_before_token||e,M(),u.space_before_token=n}function et(){if(u.raw){u.add_raw_token(p),p.directives&&p.directives.preserve==="end"&&(S.test_output_raw||(u.raw=!1));return}if(p.directives){A(!1,!0),M(),p.directives.preserve==="start"&&(u.raw=!0),A(!1,!0);return}if(!e.newline.test(p.text)&&!p.wanted_newline){u.space_before_token=!0,M(),u.space_before_token=!0;return}var t=k(p.text),n,i=!1,s=!1,o=p.whitespace_before,a=o.length;A(!1,!0),t.length>1&&(q(t.slice(1),"*")?i=!0:R(t.slice(1),o)&&(s=!0)),M(t[0]);for(n=1;n<t.length;n++)A(!1,!0),i?M(" "+r(t[n])):s&&t[n].length>a?M(t[n].substring(a)):u.add_token(t[n]);A(!1,!0)}function tt(){p.wanted_newline?A(!1,!0):u.trim(!0),u.space_before_token=!0,M(),A(!1,!0)}function nt(){I(),d==="TK_RESERVED"&&U(g.last_text)?u.space_before_token=!0:L(g.last_text===")"&&S.break_chained_methods),M()}function rt(){M(),p.text[p.text.length-1]==="\n"&&A()}function it(){while(g.mode===o.Statement)j()}var u,a=[],l,h,p,d,v,m,g,y,b,w,E,S,x="";E={TK_START_EXPR:W,TK_END_EXPR:X,TK_START_BLOCK:V,TK_END_BLOCK:$,TK_WORD:J,TK_RESERVED:J,TK_SEMICOLON:K,TK_STRING:Q,TK_EQUALS:G,TK_OPERATOR:Z,TK_COMMA:Y,TK_BLOCK_COMMENT:et,TK_COMMENT:tt,TK_DOT:nt,TK_UNKNOWN:rt,TK_EOF:it},s=s?s:{},S={},s.braces_on_own_line!==undefined&&(S.brace_style=s.braces_on_own_line?"expand":"collapse"),S.brace_style=s.brace_style?s.brace_style:S.brace_style?S.brace_style:"collapse",S.brace_style==="expand-strict"&&(S.brace_style="expand"),S.indent_size=s.indent_size?parseInt(s.indent_size,10):4,S.indent_char=s.indent_char?s.indent_char:" ",S.eol=s.eol?s.eol:"\n",S.preserve_newlines=s.preserve_newlines===undefined?!0:s.preserve_newlines,S.break_chained_methods=s.break_chained_methods===undefined?!1:s.break_chained_methods,S.max_preserve_newlines=s.max_preserve_newlines===undefined?0:parseInt(s.max_preserve_newlines,10),S.space_in_paren=s.space_in_paren===undefined?!1:s.space_in_paren,S.space_in_empty_paren=s.space_in_empty_paren===undefined?!1:s.space_in_empty_paren,S.jslint_happy=s.jslint_happy===undefined?!1:s.jslint_happy,S.space_after_anon_function=s.space_after_anon_function===undefined?!1:s.space_after_anon_function,S.keep_array_indentation=s.keep_array_indentation===undefined?!1:s.keep_array_indentation,S.space_before_conditional=s.space_before_conditional===undefined?!0:s.space_before_conditional,S.unescape_strings=s.unescape_strings===undefined?!1:s.unescape_strings,S.wrap_line_length=s.wrap_line_length===undefined?0:parseInt(s.wrap_line_length,10),S.e4x=s.e4x===undefined?!1:s.e4x,S.end_with_newline=s.end_with_newline===undefined?!1:s.end_with_newline,S.comma_first=s.comma_first===undefined?!1:s.comma_first,S.test_output_raw=s.test_output_raw===undefined?!1:s.test_output_raw,S.jslint_happy&&(S.space_after_anon_function=!0),s.indent_with_tabs&&(S.indent_char="	",S.indent_size=1),S.eol=S.eol.replace(/\\r/,"\r").replace(/\\n/,"\n"),m="";while(S.indent_size>0)m+=S.indent_char,S.indent_size-=1;var N=0;if(i&&i.length){while(i.charAt(N)===" "||i.charAt(N)==="	")x+=i.charAt(N),N+=1;i=i.substring(N)}d="TK_START_BLOCK",v="",u=new f(m,x),u.raw=S.test_output_raw,b=[],P(o.BlockStatement),this.beautify=function(){var e,t;h=new c(i,S,m),a=h.tokenize(),l=0;while(e=z()){for(var n=0;n<e.comments_before.length;n++)C(e.comments_before[n]);C(e),v=g.last_text,d=e.type,g.last_text=e.text,l+=1}return t=u.get_code(),S.end_with_newline&&(t+="\n"),S.eol!="\n"&&(t=t.replace(/[\n]/g,S.eol)),t}}function a(e){var t=0,n=-1,r=[],i=!0;this.set_indent=function(r){t=e.baseIndentLength+r*e.indent_length,n=r},this.get_character_count=function(){return t},this.is_empty=function(){return i},this.last=function(){return this._empty?null:r[r.length-1]},this.push=function(e){r.push(e),t+=e.length,i=!1},this.pop=function(){var e=null;return i||(e=r.pop(),t-=e.length,i=r.length===0),e},this.remove_indent=function(){n>0&&(n-=1,t-=e.indent_length)},this.trim=function(){while(this.last()===" "){var e=r.pop();t-=1}i=r.length===0},this.toString=function(){var t="";return this._empty||(n>=0&&(t=e.indent_cache[n]),t+=r.join("")),t}}function f(e,t){t=t||"",this.indent_cache=[t],this.baseIndentLength=t.length,this.indent_length=e.length,this.raw=!1;var n=[];this.baseIndentString=t,this.indent_string=e,this.previous_line=null,this.current_line=null,this.space_before_token=!1,this.add_outputline=function(){this.previous_line=this.current_line,this.current_line=new a(this),n.push(this.current_line)},this.add_outputline(),this.get_line_number=function(){return n.length},this.add_new_line=function(e){return this.get_line_number()===1&&this.just_added_newline()?!1:e||!this.just_added_newline()?(this.raw||this.add_outputline(),!0):!1},this.get_code=function(){var e=n.join("\n").replace(/[\r\n\t ]+$/,"");return e},this.set_indent=function(e){if(n.length>1){while(e>=this.indent_cache.length)this.indent_cache.push(this.indent_cache[this.indent_cache.length-1]+this.indent_string);return this.current_line.set_indent(e),!0}return this.current_line.set_indent(0),!1},this.add_raw_token=function(e){for(var t=0;t<e.newlines;t++)this.add_outputline();this.current_line.push(e.whitespace_before),this.current_line.push(e.text),this.space_before_token=!1},this.add_token=function(e){this.add_space_before_token(),this.current_line.push(e)},this.add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&this.current_line.push(" "),this.space_before_token=!1},this.remove_redundant_indentation=function(e){if(e.multiline_frame||e.mode===o.ForInitializer||e.mode===o.Conditional)return;var t=e.start_line_index,r,i=n.length;while(t<i)n[t].remove_indent(),t++},this.trim=function(r){r=r===undefined?!1:r,this.current_line.trim(e,t);while(r&&n.length>1&&this.current_line.is_empty())n.pop(),this.current_line=n[n.length-1],this.current_line.trim();this.previous_line=n.length>1?n[n.length-2]:null},this.just_added_newline=function(){return this.current_line.is_empty()},this.just_added_blankline=function(){if(this.just_added_newline()){if(n.length===1)return!0;var e=n[n.length-2];return e.is_empty()}return!1}}function c(r,i,s){function C(e){if(!e.match(m))return null;var t={};g.lastIndex=0;var n=g.exec(e);while(n)t[n[1]]=n[2],n=g.exec(e);return t}function k(){var s,m,g=[];w=0,E="";if(T>=N)return["","TK_EOF"];var k;x.length?k=x[x.length-1]:k=new l("TK_START_BLOCK","{");var A=r.charAt(T);T+=1;while(t(A,o)){if(e.newline.test(A)){if(A!=="\n"||r.charAt(T-2)!=="\r")w+=1,g=[]}else g.push(A);if(T>=N)return["","TK_EOF"];A=r.charAt(T),T+=1}g.length&&(E=g.join(""));if(u.test(A)||A==="."&&u.test(r.charAt(T))){var O=!0,M=!0,_=u;A==="0"&&T<N&&/[XxOoBb]/.test(r.charAt(T))?(O=!1,M=!1,/[Bb]/.test(r.charAt(T))?_=a:/[Oo]/.test(r.charAt(T))?_=f:_=c,A+=r.charAt(T),T+=1):A==="."?O=!1:(A="",T-=1);while(T<N&&_.test(r.charAt(T)))A+=r.charAt(T),T+=1,O&&T<N&&r.charAt(T)==="."?(A+=r.charAt(T),T+=1,O=!1):M&&T<N&&/[Ee]/.test(r.charAt(T))&&(A+=r.charAt(T),T+=1,T<N&&/[+-]/.test(r.charAt(T))&&(A+=r.charAt(T),T+=1),M=!1,O=!1);return[A,"TK_WORD"]}if(e.isIdentifierStart(r.charCodeAt(T-1))){if(T<N)while(e.isIdentifierChar(r.charCodeAt(T))){A+=r.charAt(T),T+=1;if(T===N)break}return!(k.type==="TK_DOT"||k.type==="TK_RESERVED"&&t(k.text,["set","get"]))&&t(A,p)?A==="in"?[A,"TK_OPERATOR"]:[A,"TK_RESERVED"]:[A,"TK_WORD"]}if(A==="("||A==="[")return[A,"TK_START_EXPR"];if(A===")"||A==="]")return[A,"TK_END_EXPR"];if(A==="{")return[A,"TK_START_BLOCK"];if(A==="}")return[A,"TK_END_BLOCK"];if(A===";")return[A,"TK_SEMICOLON"];if(A==="/"){var D="";if(r.charAt(T)==="*"){T+=1,d.lastIndex=T;var P=d.exec(r);D="/*"+P[0],T+=P[0].length;var H=C(D);return H&&H.ignore==="start"&&(y.lastIndex=T,P=y.exec(r),D+=P[0],T+=P[0].length),D=D.replace(e.lineBreak,"\n"),[D,"TK_BLOCK_COMMENT",H]}if(r.charAt(T)==="/"){T+=1,v.lastIndex=T;var P=v.exec(r);return D="//"+P[0],T+=P[0].length,[D,"TK_COMMENT"]}}if(A==="`"||A==="'"||A==='"'||(A==="/"||i.e4x&&A==="<"&&r.slice(T-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])(\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{.*?}))*\s*(\/?)\s*>/))&&(k.type==="TK_RESERVED"&&t(k.text,["return","case","throw","else","do","typeof","yield"])||k.type==="TK_END_EXPR"&&k.text===")"&&k.parent&&k.parent.type==="TK_RESERVED"&&t(k.parent.text,["if","while","for"])||t(k.type,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var B=A,j=!1,F=!1;m=A;if(B==="/"){var I=!1;while(T<N&&(j||I||r.charAt(T)!==B)&&!e.newline.test(r.charAt(T)))m+=r.charAt(T),j?j=!1:(j=r.charAt(T)==="\\",r.charAt(T)==="["?I=!0:r.charAt(T)==="]"&&(I=!1)),T+=1}else if(i.e4x&&B==="<"){var q=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])(\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{.*?}))*\s*(\/?)\s*>/g,R=r.slice(T-1),U=q.exec(R);if(U&&U.index===0){var z=U[2],W=0;while(U){var X=!!U[1],V=U[2],$=!!U[U.length-1]||V.slice(0,8)==="![CDATA[";V===z&&!$&&(X?--W:++W);if(W<=0)break;U=q.exec(R)}var J=U?U.index+U[0].length:R.length;return R=R.slice(0,J),T+=J-1,R=R.replace(e.lineBreak,"\n"),[R,"TK_STRING"]}}else while(T<N&&(j||r.charAt(T)!==B&&(B==="`"||!e.newline.test(r.charAt(T))))){(j||B==="`")&&e.newline.test(r.charAt(T))?(r.charAt(T)==="\r"&&r.charAt(T+1)==="\n"&&(T+=1),m+="\n"):m+=r.charAt(T);if(j){if(r.charAt(T)==="x"||r.charAt(T)==="u")F=!0;j=!1}else j=r.charAt(T)==="\\";T+=1}F&&i.unescape_strings&&(m=L(m));if(T<N&&r.charAt(T)===B){m+=B,T+=1;if(B==="/")while(T<N&&e.isIdentifierStart(r.charCodeAt(T)))m+=r.charAt(T),T+=1}return[m,"TK_STRING"]}if(A==="#"){if(x.length===0&&r.charAt(T)==="!"){m=A;while(T<N&&A!=="\n")A=r.charAt(T),m+=A,T+=1;return[n(m)+"\n","TK_UNKNOWN"]}var K="#";if(T<N&&u.test(r.charAt(T))){do A=r.charAt(T),K+=A,T+=1;while(T<N&&A!=="#"&&A!=="=");return A!=="#"&&(r.charAt(T)==="["&&r.charAt(T+1)==="]"?(K+="[]",T+=2):r.charAt(T)==="{"&&r.charAt(T+1)==="}"&&(K+="{}",T+=2)),[K,"TK_WORD"]}}if(A==="<"&&(r.charAt(T)==="?"||r.charAt(T)==="%")){b.lastIndex=T-1;var Q=b.exec(r);if(Q)return A=Q[0],T+=A.length-1,A=A.replace(e.lineBreak,"\n"),[A,"TK_STRING"]}if(A==="<"&&r.substring(T-1,T+3)==="<!--"){T+=3,A="<!--";while(!e.newline.test(r.charAt(T))&&T<N)A+=r.charAt(T),T++;return S=!0,[A,"TK_COMMENT"]}if(A==="-"&&S&&r.substring(T-1,T+2)==="-->")return S=!1,T+=2,["-->","TK_COMMENT"];if(A===".")return[A,"TK_DOT"];if(t(A,h)){while(T<N&&t(A+r.charAt(T),h)){A+=r.charAt(T),T+=1;if(T>=N)break}return A===","?[A,"TK_COMMA"]:A==="="?[A,"TK_EQUALS"]:[A,"TK_OPERATOR"]}return[A,"TK_UNKNOWN"]}function L(e){var t=!1,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r),r++;if(t){t=!1;if(o==="x")i=e.substr(r,2),r+=2;else{if(o!=="u"){n+="\\"+o;continue}i=e.substr(r,4),r+=4}if(!i.match(/^[0123456789abcdefABCDEF]+$/))return e;s=parseInt(i,16);if(s>=0&&s<32){o==="x"?n+="\\x"+i:n+="\\u"+i;continue}if(s===34||s===39||s===92)n+="\\"+String.fromCharCode(s);else{if(o==="x"&&s>126&&s<=255)return e;n+=String.fromCharCode(s)}}else o==="\\"?t=!0:n+=o}return n}var o="\n\r	 ".split(""),u=/[0-9]/,a=/[01]/,f=/[01234567]/,c=/[0123456789abcdefABCDEF]/,h="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: =>".split(" ");this.line_starters="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export".split(",");var p=this.line_starters.concat(["do","in","else","get","set","new","catch","finally","typeof","yield","async","await"]),d=/([\s\S]*?)((?:\*\/)|$)/g,v=/([^\n\r\u2028\u2029]*)/g,m=/\/\* beautify( \w+[:]\w+)+ \*\//g,g=/ (\w+)[:](\w+)/g,y=/([\s\S]*?)((?:\/\*\sbeautify\signore:end\s\*\/)|$)/g,b=/((<\?php|<\?=)[\s\S]*?\?>)|(<%[\s\S]*?%>)/g,w,E,S,x,T,N;this.tokenize=function(){N=r.length,T=0,S=!1,x=[];var e,t,n,i=null,s=[],o=[];while(!t||t.type!=="TK_EOF"){n=k(),e=new l(n[1],n[0],w,E);while(e.type==="TK_COMMENT"||e.type==="TK_BLOCK_COMMENT"||e.type==="TK_UNKNOWN")e.type==="TK_BLOCK_COMMENT"&&(e.directives=n[2]),o.push(e),n=k(),e=new l(n[1],n[0],w,E);o.length&&(e.comments_before=o,o=[]),e.type==="TK_START_BLOCK"||e.type==="TK_START_EXPR"?(e.parent=t,s.push(i),i=e):(e.type==="TK_END_BLOCK"||e.type==="TK_END_EXPR")&&i&&(e.text==="]"&&i.text==="["||e.text===")"&&i.text==="("||e.text==="}"&&i.text==="{")&&(e.parent=i.parent,i=s.pop()),x.push(e),t=e}return x}}var e={};(function(e){var t=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,n="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",r="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",i=new RegExp("["+n+"]"),s=new RegExp("["+n+r+"]"),o=e.newline=/[\n\r\u2028\u2029]/,u=e.lineBreak=/\r\n|[\n\r\u2028\u2029]/g,a=e.isIdentifierStart=function(e){return e<65?e===36||e===64:e<91?!0:e<97?e===95:e<123?!0:e>=170&&i.test(String.fromCharCode(e))},f=e.isIdentifierChar=function(e){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e>=170&&s.test(String.fromCharCode(e))}})(e);var o={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},l=function(e,t,n,r,i,s){this.type=e,this.text=t,this.comments_before=[],this.newlines=n||0,this.wanted_newline=n>0,this.whitespace_before=r||"",this.parent=null,this.directives=null};typeof define=="function"&&define.amd?define("beautify",[],function(){return{js_beautify:s}}):typeof exports!="undefined"?exports.js_beautify=s:typeof window!="undefined"?window.js_beautify=s:typeof global!="undefined"&&(global.js_beautify=s)}(),define("../app/code",[],function(){function u(e){t=e}function a(t){var n=t.split("\n");for(var r=0;r<n.length;r++){var i=n[r];i!=""&&e.indexOf(i)<0&&e.push(i)}}function f(e){n=[],r=[],i=[],m();if(!e){var t=s,o=l();o!=""&&(t+="\n"+o);var u=c();u!=""&&(t+="\n"+u+"\n"),t+="void setup() {\n";var a=h();return a!=""&&(t+=a),t+="    \n}\n\n",t+="void loop() {\n    \n}",t}return e=v(e,l(),"head"),e=v(e,c(),"variable"),e=v(e,h(),"setup"),e}function l(){for(var t=0;t<e.length;t++){var r=e[t];r!=""&&n.indexOf(r)<0&&n.push(r)}n=n.sort(function(e,t){return e.localeCompare(t)});var i="",s="";for(var t=0;t<n.length;t++)s+=n[t]+"\n";return i+=d(s,"head"),i}function c(){var e="",t="";for(var n=0;n<r.length;n++)t+=r[n];return e+=d(t,"variable"),e}function h(){var e="",t="";for(var n=0;n<i.length;n++)t+=i[n];return e+=d(t,"setup","    "),e}function p(e){e=e||1;var t="";for(var n=0;n<e;n++)t+="    ";return t}function d(e,t,n){return n=n||"",o.replace("{{code}}",e).replace("{{tag}}",t).replace(/\{\{indent\}\}/g,n)}function v(e,t,n){var r="//end auto generate. block tag: "+n,i=e.indexOf(r);if(i<0)return e;var s="//auto generate",o=e.lastIndexOf(s,i);return o<0?e:(o=e.lastIndexOf("\n",o)+1,i=i+r.length+1,e.replace(e.substring(o,i),t))}function m(){var e=t();for(var s=0;s<e.length;s++){var o=e[s];if(o.headCode!=""){var u=o.headCode.split("\n");for(var a=0;a<u.length;a++){var f=u[a];f!=""&&n.indexOf(f)<0&&n.push(f)}}var l=o.ports,c,h=o.varCode;if(h!=""){h=h.replace(/\$NAME/g,o.varName);for(var a=0;a<l.length;a++)c=l[a],h=h.replace("$"+c.source,c.target);r.push(h)}var p=o.setupCode;if(p!=""){p=p.replace(/\$NAME/g,o.varName);for(var a=0;a<l.length;a++)c=l[a],p=p.replace("$"+c.source,c.target);p=p.replace(/([^\n]*\n)/g,"    $1"),i.push(p)}}}var e=[],t,n,r,i,s="/************************************************************\n *Copyright(C), 2016-2038, KenRobot.com\n *FileName:  //文件名\n *Author:    //作者\n *Version:   //版本\n *Date:      //完成日期\n */\n",o="{{indent}}//auto generate\n{{indent}}//warning: please don't modify\n{{code}}{{indent}}//end auto generate. block tag: {{tag}}\n";return{init:u,gen:f,addLibrary:a}}),define("../app/software",["ace/ace","ace/ext-language_tools","beautify","jquery","./EventManager","./code"],function(e,e,t,n,r,i){function u(e){s=ace.edit(n(".software .editor")[0]),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),s.setShowPrintMargin(!1),s.$blockScrolling=Infinity,s.setTheme("ace/theme/default"),s.session.setMode("ace/mode/arduino"),n(".software .back").on("click",function(e){r.trigger("project","switchPanel",0)}),i.init(e)}function a(e){e=e||{};var t=e.source||i.gen();s.setValue(t,1)}function f(){return{source:s.getValue()}}function l(){s.setValue(i.gen(s.getValue()),1)}function c(e){i.addLibrary(e.code)}function h(){var e=o(s.getValue());s.setValue(e,1)}var s,o=t.js_beautify;return{init:u,getData:f,setData:a,gen:l,addLibrary:c,format:h}}),define("../app/board",["jquery","./util"],function(e,t){function s(){i=".board .list > li.normal",e(i).on("click",f)}function o(t){r=t,e(i).eq(0).click()}function u(){return{id:n.id,name:n.name,board_type:n.board_type}}function a(t){t=t||{};var n=t.id||1;for(var s in r){var o=r[s];if(o.id==n){e(i).filter('[data-board="'+s+'"]').click();break}}}function f(i){var s=e(this),o=s.data("board");n=r[o],t.toggleActive(s)}var n,r,i;return{init:s,load:o,getData:u,setData:a}}),define("../app/project",["jquery","./EventManager","./util","./config","./user","./hardware","./software","./board"],function(e,t,n,r,i,s,o,u){function c(){e(".project .operation li").on("click",w),t.bind("project","switchPanel",k),t.bind("user","login",L),d()}function h(t){var n=function(){var n=l.project_name,r=u.getData(),i=o.getData();e.ajax({type:"POST",url:"/build",data:{source:i.source,project_name:n,build_type:"Arduino",board_type:r.board_type},dataType:"json"}).done(function(e){t&&t(e)})};r.buildAuth?i.authCheck(function(e){if(!e){i.showLoginDialog(n);return}n()}):n()}function p(t){var n=e("#save-dialog"),r=e("form",n),i=t?M():l;e('input[name="name"]',r).val(i.project_name),e('textarea[name="intro"]',r).val(i.project_intro),e('input[name="public-type"][value="'+i.public_type+'"]',r).attr("checked",!0);var s=t?"创建项目":"保存项目";e('input[name="save"]',r).val(s),e(".close-btn",n).off("click").on("click",function(t){n.slideUp(100),e(".dialog-layer").removeClass("active")}),e(".save",n).off("click").on("click",function(){m(i.id)}),n.css({top:-n.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function d(){i.authCheck(function(t){t?e.ajax({url:"/projects/"+i.getUserId(),dataType:"json"}).done(v):(a.push(M()),C(0))})}function v(t){t.status!=0?a=[]:a=t.data,a.length==0&&a.push(M());var n=e(".project .list ul").empty();for(var r=0;r<a.length;r++){var i=a[r];try{i.project_data=JSON.parse(i.project_data)}catch(s){console.log(s.message),i.project_data={}}n.append(O(i))}C(-1)}function m(t){var r=e("#save-dialog form"),s={id:t,project_name:e('input[name="name"]',r).val(),user_id:i.getUserId(),project_intro:e('textarea[name="intro"]',r).val(),project_data:JSON.stringify(A()),public_type:e("input[name='public-type']:checked",r).val()};e("#save-dialog .close-btn").click(),e.ajax({type:"POST",url:"/project/save",data:s,dataType:"json"}).done(function(r){n.message(r.message),r.status==0&&e.ajax({url:"project/"+r.data.project_id,dataType:"json"}).done(function(e){g(t,e)})})}function g(t,r){if(r.status!=0){n.message(r.message);return}var i=r.data,s=e(".project .list > ul");if(t==0){s.find('> li[data-project-id="0"]').remove();for(var o=0;o<a.length;o++){var u=a[o];if(u.id==0){a.splice(o,1);break}}a.push(i),s.append(O(i)),l=i,C(-1)}else{var f=-1;for(var o=0;o<a.length;o++){var u=a[o];if(u.id==i.id){f=o;break}}a[f]=i,s.find('> li[data-project-id="'+i.id+'"]').find(".name").text(i.project_name),l=i}}function y(t){var r=e(this).parent();if(n.toggleActive(r,null,!0)){var i=r.data("project-id");l=i==0?M():_(i);var a=l.project_data;u.setData(a.board),s.setData(a.hardware),o.setData(a.software);var f=r.find(".view > div");f.filter(".active").length==0?f.eq(0).click():f.filter(".active").click()}}function b(t){var r=l.project_data,i=e(this);n.toggleActive(i,"div");var u=i.index(),a=e(".sidebar .bar ul > li"),f=e(".sidebar .tab");if(u==0){a.filter('[data-action="board"],[data-action="component"]').removeClass("hide"),a.filter('[data-action="library"],[data-action="format"]').addClass("hide"),f.filter(".tab-board,.tab-component").removeClass("hide"),f.filter(".tab-library").addClass("hide");var c=a.filter('[data-action="component"]');c.hasClass("active")||c.click(),r.software=o.getData()}else{a.filter('[data-action="board"],[data-action="component"]').addClass("hide"),a.filter('[data-action="library"],[data-action="format"]').removeClass("hide"),f.filter(".tab-board,.tab-component").addClass("hide"),f.filter(".tab-library").removeClass("hide");var h=a.filter('[data-action="project"]');h.hasClass("active")||h.click(),r.hardware=s.getData(),o.gen()}e(".main > .tabs").css({"margin-left":e(".sidebar").width()}),e(".main > .tabs .tab").removeClass("active").eq(u).addClass("active")}function w(t){var n=e(this),r=n.data("action");switch(r){case"new":E();break;case"delete":S();break;case"cancel":T();break;case"confirm":N()}}function E(e){i.authCheck(function(e){e?p(!0):i.showLoginDialog()})}function S(e){if(l.id==0){n.message("你的项目尚未保存");return}i.authCheck(function(e){e?n.dialog({selector:".delete-project-dialog",okFunc:function(){x(l.id)}}):i.showLoginDialog()})}function x(t){e.ajax({type:"POST",url:"/project/delete",data:{id:t,user_id:i.getUserId()},dataType:"json"}).done(function(r){n.message(r.message);if(r.status==0){var i=e('.project .list > ul > li[data-project-id="'+t+'"]').remove();for(var s=0;s<a.length;s++){var o=a[s];if(o.id==t){a.splice(s,1);break}}if(a.length==0){var u=M();a.push(u),e(".project .list > ul").append(O(u)),C(-1)}else{var f=e(".project .list .title");f.eq(f.length-1).click()}}})}function T(e){}function N(e){}function C(t){e(".project .list .view > div").off("click").on("click",b);var n=e(".project .list .title").off("click").on("click",y);typeof t=="number"&&(t==-1?n.eq(n.length-1).click():e('.project .list >  ul > li[data-project-id="'+t+'"] .title').click())}function k(t){e(".project .list .view > div.active").parent().find("div").eq(t).click()}function L(){e.ajax({url:"/projects/"+i.getUserId(),dataType:"json"}).done(v)}function A(){return{board:u.getData(),hardware:s.getData(),software:o.getData()}}function O(e){return f.replace(/\{\{project_name\}\}/g,e.project_name).replace(/\{\{id\}\}/g,e.id)}function M(){return{id:0,user_id:i.getUserId(),project_name:"我的项目",project_intro:"我的项目简介",public_type:1,project_data:{}}}function _(e){for(var t=0;t<a.length;t++){var n=a[t];if(n.id==e)return n}}var a=[],f='<li data-project-id="{{id}}"><div class="title"><span class="name">{{project_name}}</span><i class="iconfont icon-lashenkuangxiangxia"></i></div><div class="view"><div><span class="name">{{project_name}}</span>.uno</div><div><span class="name">{{project_name}}</span>.ino</div></div></li>',l;return{init:c,build:h,showSaveDialog:p}}),define("../app/ext/burn-dialog",["jquery","../util"],function(e,t){function a(t){if(n)return;n=!0,i=t,s=window.location.protocol+"//"+window.location.host,r=".burn-dialog";var o;navigator.userAgent.indexOf("WOW64")!=-1||navigator.userAgent.indexOf("Win64")!=-1?o=64:o=32;var u="http://platform.kenrobot.com/download/arduino-driver-x"+o+".zip";e(".arduino-driver-dialog .downloadUrl").attr("href",u),e(".tab-no-serial .driver",r).on("click",h),e(".tab-connect .connect",r).on("click",p),e(".tab-burn .burn",r).on("click",d)}function f(e){u=e,t.dialog({selector:r,closeFunc:l}),c()}function l(){e(".tab",r).removeClass("active").eq(0).addClass("active"),e(".tab-burn .burn-progress",r).removeClass("active"),e(".tab-connect .port",r).empty(),g({action:"serial.disconnect",connectionId:o}),o=null,u=null,m(!1)}function c(){g("serial.getDevices",function(t){if(t.length==0){y("no-serial"),setTimeout(c,1);return}var n=e(".tab-connect .port",r).empty(),i=0;for(var s=0;s<t.length;s++){var o=t[s];e("<option>").text(o.path).attr("title",o.displayName).appendTo(n),o.displayName&&o.displayName.toLowerCase().indexOf("arduino")>-1&&i++}i==1?e(".tab-connect .connect",r).click():y("connect")})}function h(n){e(".x-dialog-close",r).click(),setTimeout(function(){t.dialog(".arduino-driver-dialog")},400)}function p(t){var n=e(".tab-connect .port",r).val(),i=parseInt(e(".tab-connect .bitRate",r).val());g({action:"serial.connect",portPath:n,bitRate:i},function(e){e?(o=e,y("burn")):(y("connect"),b("连接失败","connect"))})}function d(t){e(".tab-burn .burn",r).addClass("burning").attr("disabled",!0),e(".tab-burn .burn-progress",r).addClass("active"),w(0),b("正在烧写","burn",0),g({action:"upload",url:s+u+"/hex",delay:i.uploadDelay},function(t){m(!1),e(".tab-burn .burn",r).removeClass("burning").attr("disabled",!1),e(".tab-burn .burn-progress",r).removeClass("active"),e(".tab-burn .burn-progress ul li.ins",r).removeClass("ins"),b("烧写"+(t?"成功":"失败"),"burn",0)}),m(!0)}function m(e){clearInterval(v);if(e){var t=function(){g("upload.progress",function(e){w(e)})};v=setInterval(t,i.uploadDelay)}}function g(e,t){e=typeof e=="string"?{action:e}:e,t=t||function(){},chrome.runtime.sendMessage(i.appId,e,t)}function y(n){t.toggleActive(e(".tab-"+n,r),"div"),n!="connect"&&n=="burn"&&(e(".tab-burn .burn",r).removeClass("burning").attr("disabled",!1),e(".tab-burn .burn-progress",r).removeClass("active"),e(".tab-burn .burn-progress ul li.ins",r).removeClass("ins"),b("准备就绪","burn",0))}function b(t,n,i){var s=e(".tab-"+n+" .message",r).text(t).stop().show();i!=0&&(i=i||2e3,s.delay(i).queue(function(){s.hide(),s.dequeue()}))}function w(t){var n=e(".tab-burn .burn-progress ul li",r),i=n.filter("ins").last().index(),s=Math.floor(t/100*n.length);for(var o=i+1;o<=s;o++)n.eq(o).addClass("ins")}var n,r,i,s,o,u,v;return{init:a,show:f}}),define("../app/ext/agent",["../util","../user","./burn-dialog"],function(e,t,n){function i(e){r=e}function s(n){var i=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(!i&&!window.chrome){e.message("Kenrobot平台扩展目前只支持Chrome浏览器，其它浏览器敬请期待！");return}o(function(e){if(!e){u();return}r.launchAuth?t.authCheck(function(e){e?n():t.showLoginDialog(n)}):n()})}function o(e){chrome.runtime.sendMessage(r.appId,"ping",function(t){t&&t.action=="ping"&&t.result=="pong"?e(!0):e(!1)})}function u(){e.dialog(".install-dialog")}function a(e){s(function(){n.init(r),n.show(e)})}var r;return{init:i,showBurnDialog:a}}),define("../app/sidebar",["jquery","./EventManager","./util","./config","./user","./project","./board","./software","./ext/agent"],function(e,t,n,r,i,s,o,u,a){function f(){e(".sidebar .logo").on("click",l),e(".sidebar .bar ul > li").on("click",c).filter('[data-action="component"]').click()}function l(e){i.authCheck(function(e){e?n.message("你已登录"):i.showLoginDialog(null,1)})}function c(t){var r=e(this),i=r.index(),s=r.data("action");switch(s){case"save":h();break;case"download":d();break;case"serial":m();break;case"burn":v();break;case"format":p();break;default:var o=e(".sidebar .tab.tab-"+s);n.toggleActive(r,null,!0);var u=n.toggleActive(o,".tab",!0);e(".main > .tabs").css({"margin-left":e(".sidebar").width()})}}function h(){i.authCheck(function(e){e?s.showSaveDialog():i.showLoginDialog(s.showSaveDialog)})}function p(){u.format()}function d(){s.build(function(e){n.message(e.message),e.status==0&&e.url&&(window.location.href=e.url)})}function v(){s.build(function(e){e.status==0&&e.url?a.showBurnDialog(e.url):n.message(e.message)})}function m(){}return{init:f}}),define("../app/component",["jquery","jquery-ui","bootstrap-typeahead","./EventManager","./util","./hardware"],function(e,t,t,n,r,i){function a(){u=e(".component .items .list > li").on("click",c).draggable({disabled:!0,appendTo:".drag-layer",scope:"hardware",revert:!0,revertDuration:0,zIndex:9999,containment:"window",helper:h}),n.bind("hardware","changeInteractiveMode",l)}function f(e){o=e,p()}function l(e){u.draggable("option","disabled",e!="drag")}function c(t){var n=e(this);r.toggleActive(n),i.setPlaceComponent(n.data("component-name"))}function h(t){var n=e(this).data("component-name"),r=o[n];return e(".image",this).clone().css({width:r.width,height:r.height}).data("component-name",n)}function p(){var t=[];for(var n in o)t.push(o[n]);e(".search .key").typeahead({source:t,displayText:function(e){return typeof e!="undefined"&&typeof e.label!="undefined"&&e.label||e},updater:function(t){return e('.component .items .list > li[data-component-name="'+t.name+'"').click(),t}})}var s,o,u;return{init:a,load:f}}),define("../app/library",["jquery","./software"],function(e,t){function r(){e(".library .list > li").on("click",s)}function i(e){n=e}function s(r){var i=e(this),s=i.data("library"),o=n[s];if(!o)return;t.addLibrary(o),t.gen()}var n;return{init:r,load:i}}),define("../app/guide",["jquery","./config","./util"],function(e,t,n){function i(){r=t.guide;var n=e(".guide-layer");r.showIfFirstVisit?(n.on("click",s).show(),s()):n.remove()}function s(){var t=e(".guide-step"),r=t.filter(".active").index();if(r+1<t.length){r+=1;var i=t.eq(r);n.toggleActive(i,"div"),r+1==t.length&&i.css({left:(e(window).width()-i.width())/2})}else e(".guide-layer").remove()}var r;return{init:i}}),define("../app/app-index",["jquery","./config","./hardware","./user","./project","./software","./sidebar","./board","./component","./library","./ext/agent","./guide"],function(e,t,n,r,i,s,o,u,a,f,l,c){function h(){d(),p(),r.init(),o.init(),u.init(),a.init(),f.init(),n.init(),s.init(n.getNodes),l.init(t.extension),c.init(),e.ajax({url:"/config",dataType:"json"}).done(v)}function p(){e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}})}function d(){if(t.needPV){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?6518098de0bee39bef219952dbbae669";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}function v(e){u.load(e.boards),a.load(e.components),f.load(e.libraries),n.load(e),i.init()}return{init:h}});