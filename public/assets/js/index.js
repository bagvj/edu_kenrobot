define("app/EventManager",[],function(){function e(e,t){return e+"_"+t}function t(t,n,i){var a=e(t,n),r=o[a];r||(r=[],o[a]=r),r.push(i)}function n(t,n,i){var a=e(t,n),r=o[a];if(r)for(var c=0;c<r.length;c++){var s=r[c];if(s==i){r.splice(c,1);break}}}function i(t,n,i){var a=e(t,n),r=o[a];if(r)for(var c=0;c<r.length;c++){var s=r[c];s(i)}}var o={};return{bind:t,unbind:n,trigger:i}}),define("app/util",[],function(){function e(e){var t=300;$("div.x-message").stop(!0).fadeOut(t/2,function(){$(this).remove()}),e="string"==typeof e?{text:e}:e;var n=e.type||"info",i=e.text,o='<div class="x-message x-message-'+n+'"><i class="x-message-close kenrobot ken-close"></i>'+i+"</div>",a=$(o);$(".x-message-close",a).on("click",function(){a.stop(!0).fadeOut(t/2,function(){a.remove()})}),a.appendTo($(".message-layer")).css({left:($(window).width()-a.width())/2,top:-a.height()}).animate({top:150},t,"swing").delay(2e3).fadeOut(t,function(){a.remove()})}function t(e){e="string"==typeof e?{selector:e}:e;var t=e.selector,n=$(t);if(!n||!n.hasClass("x-dialog"))return!1;var i=e.onConfirm,o=e.onCancel,a=e.onClosing,r=e.onClose,c=e.onShow,s=e.content;s&&$(".x-dialog-content",n).text(s);var u=$(".dialog-layer").addClass("active"),d=function(e){n.removeClass("dialog-fadeIn").addClass("dialog-fadeOut").delay(300).queue(function(){n.hide().removeClass("dialog-fadeOut"),u.removeClass("active"),r&&r(),e&&e()})};return $(".x-dialog-btns .confirm",n).off("click").on("click",function(){a&&0==a()||d(i)}),$(".x-dialog-close,.x-dialog-btns .cancel",n).off("click").on("click",function(){a&&0==a()||d(o)}),c&&c(),n.stop().show().removeClass("dialog-fadeOut").addClass("dialog-fadeIn"),n}function n(){return $(".dialog-layer").hasClass("active")}function i(e,t,n){return n=n||"active",t?e.hasClass(n)?(e.removeClass(n),!1):(e.siblings("."+n).removeClass(n),e.addClass(n),!0):e.hasClass(n)?!1:(e.siblings("."+n).removeClass(n),e.addClass(n),!0)}function o(e,t){var n=new CustomEvent(e,{detail:t});window.dispatchEvent(n)}return{message:e,dialog:t,isInDialog:n,toggleActive:i,dispatchEvent:o}}),!function(e){e(jQuery)}(function(e){function t(e){return c.raw?e:encodeURIComponent(e)}function n(e){return c.raw?e:decodeURIComponent(e)}function i(e){return t(c.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),c.json?JSON.parse(e):e}catch(t){}}function a(t,n){var i=c.raw?t:o(t);return e.isFunction(n)?n(i):i}var r=/\+/g,c=e.cookie=function(o,r,s){if(void 0!==r&&!e.isFunction(r)){if(s=e.extend({},c.defaults,s),"number"==typeof s.expires){var u=s.expires,d=s.expires=new Date;d.setTime(+d+864e5*u)}return document.cookie=[t(o),"=",i(r),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var l=o?void 0:{},f=document.cookie?document.cookie.split("; "):[],p=0,g=f.length;g>p;p++){var v=f[p].split("="),h=n(v.shift()),m=v.join("=");if(o&&o===h){l=a(m,r);break}o||void 0===(m=a(m))||(l[h]=m)}return l};c.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),define("vendor/jquery.cookie",function(){}),define("app/config",[],function(){return{guide:{showIfFirstVisit:!0,autoNextDelay:3e3},project:{maxCodeLength:10485760},extension:{appId:"hhgmonhbodfiplppmcangkmlfkcnilpd",uploadDelay:250,bitRate:115200}}}),define("app/userApi",["./config"],function(e){function t(){return $.ajax({type:"POST",url:r+"/api/auth/check",data:{id:0},dataType:"json"})}function n(e,t){return $.ajax({type:"POST",url:r+"/api/auth/login",dataType:"json",data:{email:e,password:t}})}function i(e){return $.ajax({type:"POST",url:r+"/api/auth/login/weixin",data:{key:e},dataType:"json"})}function o(){return $.ajax({type:"POST",url:r+"/api/auth/info",data:{id:0},dataType:"json"})}function a(){return $.ajax({type:"POST",url:r+"/api/auth/logout",data:{id:0},dataType:"json"})}var r=e.host||"";return{authCheck:t,login:n,weixinLogin:i,loginInfo:o,logout:a}}),define("app/user",["vendor/jquery.cookie","./EventManager","./util","./config","./userApi"],function(e,t,n,i,o){function a(){l(),v(),h(),$(".user-login li").on("click",k),i.pc&&u().done(x)}function r(){return j?j.id:0}function c(){return j}function s(){return j?j.name:""}function u(e){var t=$.Deferred();return o.authCheck().done(function(e){0==e.status?(j=e.user,t.resolve(e.user)):(j=null,t.reject())}),t}function d(e,t,i){C=e;var o=n.dialog({selector:".login-dialog",onClosing:function(){C=null,p(!1)}});$(".email",o).val(""),$(".password",o).val(""),t=t||"account",$(".switch ."+t,o).click(),i?($(".switch",o).removeClass("active"),$(".login-tips",o).removeClass("active"),$(".register-tips",o).addClass("active"),$(".footer .login-footer",o).removeClass("active"),$(".footer .register-footer",o).addClass("active")):($(".switch",o).addClass("active"),$(".login-tips",o).addClass("active"),$(".register-tips",o).removeClass("active"),$(".footer .login-footer",o).addClass("active"),$(".footer .register-footer",o).removeClass("active")),"account"==t&&$(".email",o).focus()}function l(){var e=$(".login-dialog");i.pc&&o.loginInfo().done(function(t){$(".qrcode-key",e).val(t.key),$(".qrcode",e).attr("src",t.qrcode),$(".forget-password",e).attr("href",t.find_password_url),$(".register",e).attr("href",t.register_url)});var t=$(".scan",e);$(".switch li",e).on("click",function(){var t=$(this),i=t.data("action"),o=$(".tab-"+i,e);n.toggleActive(o),n.toggleActive(t),"weixin"==i?p(!0):($(".email",e).focus(),p(!1))}),$(".login-btn",e).on("click",f);var a;$(".qrcode",e).hover(function(n){e.is(":animated")||(clearTimeout(a),t.stop().show().removeClass("x-fadeOut").addClass("x-fadeIn"))},function(n){e.is(":animated")||(t.removeClass("x-fadeIn").addClass("x-fadeOut"),a=setTimeout(function(){t.hide().removeClass("x-fadeOut")},300))}),$("form",e).on("keyup",function(t){13==t.keyCode&&$(".tab-account",e).hasClass("active")&&$(".login-btn",e).trigger("click")})}function f(){var e=$(".login-dialog"),i=$(".email",e).val(),a=$(".password",e).val();o.login(i,a).done(function(i){if(0==i.status)n.message(i.message),$(".x-dialog-close",e).click(),x(i.data),g(),t.trigger("user","login");else if(1==i.status)x(i.data),g();else{var o=$(".message",e);o.addClass("active").text(i.message).delay(2e3).queue(function(){o.removeClass("active").text("").dequeue()})}})}function p(e){if(clearInterval(y),e){var i=$(".login-dialog"),a=function(){var e=$(".qrcode-key",i).val();o.weixinLogin(e).done(function(e){0==e.status?(p(!1),$(".x-dialog-close",i).click(),n.message(e.message),x(e.data),g(),t.trigger("user","login")):1==e.status&&(p(!1),x(e.data))})};y=setInterval(a,3e3)}}function g(){C&&C()}function v(){var e=$(".user"),t=$(".user-menu",e),n=function(){t.hide()};t.on("mouseleave",n),e.on("mouseleave",n),$(".user-info",e).on("mouseover",function(){t.show()}),$("ul > li",t).on("click",m),e.hasClass("active")&&$(".top-menu").css({"margin-right":e.width()})}function h(){var e=$(".copyright"),t=$.cookie("hideCopyright");t?e.remove():(e.addClass("active"),$(".close-btn",e).on("click",function(){e.fadeOut(function(){e.remove(),$.cookie("hideCopyright",!0)})}))}function m(e){var t=$(this),a=t.data("action");switch(a){case"share":n.message("敬请期待");break;case"setting":n.message("敬请期待");break;case"logout":i.pc?o.logout().done(function(){n.dispatchEvent("app:reload")}):window.location.href="/logout"}}function x(e){j=e;var t=$(".user"),n=$(".top-menu");j?(t.addClass("active"),$(".photo img",t).attr("src",j.avatar_url),$(".name",t).text(j.name),n.css({"margin-right":t.width()})):(t.removeClass("active"),$(".name",t).text(""),$(".photo img",t).attr("src","#"),n.css({"margin-right":0}))}function k(e){var t=$(this).data("action");d(null,"weixin","register"==t)}var j,y,C;return{init:a,getUserId:r,getUserInfo:c,getUserName:s,authCheck:u,showLoginDialog:d}}),define("app/projectApi",["./config","./user","./util"],function(e,t,n){function i(e,n){n=n||"id";var i={};return i.user_id=t.getUserId(),"hash"==n?i.hash=e:"last"==n?i.type="last":i.id=e,$.ajax({type:"POST",url:s+"/api/project/get",data:i,dataType:"json"})}function o(){return $.ajax({type:"POST",url:s+"/api/projects/user",data:{user_id:t.getUserId()},dataType:"json"})}function a(t){return e.pc?window.kenrobot.api.project.save(t):$.ajax({type:"POST",url:s+"/api/project/save",data:t,dataType:"json"})}function r(n){return e.pc?window.kenrobot.api.project.build(n):$.ajax({type:"POST",url:s+"/api/project/build",dataType:"json",data:{id:n,user_id:t.getUserId()}})}function c(n){return e.pc?window.kenrobot.api.project.remove(n):$.ajax({type:"POST",url:s+"/api/project/delete",data:{id:n,user_id:t.getUserId()},dataType:"json"})}var s=e.host||"";return{get:i,getAll:o,save:a,build:r,remove:c}}),define("app/ext/uploader",[],function(){function e(e,t){o=e,a=t,r=window.location.protocol+"//"+window.location.host}function t(e,t){var o=function(i){for(var o,a=0;a<i.length;a++){var r=i[a],s=r.displayName;if(s&&c.test(s)){o=r;break}}return o?void n(e,o.path,t):void t(2,i)},a=!0,r=function(){i("serial.getDevices",function(e){return e&&0!=e.length?void o(e):void(a?(a=!1,setTimeout(r,1e3)):t(1))})};r()}function n(e,t,n){i({action:"serial.connect",portPath:t,bitRate:a.bitRate},function(t){return t?void i({action:"upload",url:r+e+"/hex",delay:a.uploadDelay},function(e){i({action:"serial.disconnect",connectionId:t}),n(e?0:4)}):void n(3)})}function i(e,t){e="string"==typeof e?{action:e}:e,t=t||function(){},o.runtime.sendMessage(a.appId,e,t)}var o,a,r,c=/(arduino)|(\/dev\/cu\.usbmodem)/i;return{init:e,upload:t,resumeUpload:n}}),define("app/ext/agent",["../util","./uploader"],function(e,t){function n(e){d=e,l=a(),t.init(l,d);var n;n=-1!=navigator.userAgent.indexOf("WOW64")||-1!=navigator.userAgent.indexOf("Win64")?64:32;var i="/download/arduino-driver-x"+n+".zip";$(".arduino-driver-dialog .downloadUrl").attr("href",i)}function i(t){return o()&&l?void r(function(e){e?t():c()}):void e.message("啃萝卜扩展目前只支持Chrome浏览器，其它浏览器敬请期待！")}function o(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1}function a(){return o()?window.chrome:null}function r(e){l.runtime.sendMessage(d.appId,"ping",function(t){e(t&&"ping"==t.action&&"pong"==t.result?!0:!1)})}function c(){e.dialog(".install-dialog")}function s(e,n){i(function(){t.upload(e,n)})}function u(e,n,i){t.resumeUpload(e,n,i)}var d,l;return{init:n,upload:s,resumeUpload:u}}),define("app/project",["./EventManager","./config","./util","./projectApi","./user","./ext/agent"],function(e,t,n,i,o,a){function r(){e.bind("user","login",d);var t=angular.element(".ng-app").scope();t.$on("onRouteChange",y)}function c(){O().setProject()}function s(){o.authCheck().then(h,o.showLoginDialog)}function u(){t.pc?x():o.authCheck().then(x,o.showLoginDialog)}function d(){l()}function l(){var e=$.Deferred();return o.authCheck().done(function(){i.getAll().done(function(t){f(t.data),e.resolve()})}).fail(function(){e.resolve()}),e}function f(e){e.forEach(function(e){U.push(p(e))})}function p(e){if("string"==typeof e.project_data)try{e.project_data=JSON.parse(e.project_data)}catch(t){e.project_data={}}return"string"==typeof e.created_at&&(e.created_at=new Date(e.created_at)),"string"==typeof e.updated_at&&(e.updated_at=new Date(e.updated_at)),e}function g(){return projectInfo}function v(e){projectInfo=e||b(),O().setProject(projectInfo.project_data),T=!1}function h(){var e=g(),t=e.id;if(0==t)return void n.message("请先保存");var o={};o.isBuilding=!0;var r=n.dialog({selector:".building-dialog",onClosing:function(){return!o.isBuilding}}),c=$(".x-dialog-content",r).text("正在保存...");$(".confirm-btn",r).off("click").on("click",function(){if(!o.resume)return void $(".x-dialog-close",r).click();o.resume=!1;var e=$(".portList",r).val();c.text("正在烧写..."),a.resumeUpload(o.url,e,function(e){var t;switch(e){case 0:t="烧写成功",o.isBuilding=!1;break;case 3:t="连接失败",o.isBuilding=!1;break;case 4:default:t="烧写失败",o.isBuilding=!1}c.html(t)})}),j(t,!1,function(e){return 0!=e?(c.text("保存失败"),void(o.isBuilding=!1)):(c.text("保存成功，正在编译..."),void i.build(t).done(function(e){return 0!=e.status?(c.text("编译失败"),void(o.isBuilding=!1)):(c.text("编译成功，正在烧写..."),void m(e.url,c,o))}))})}function m(e,t,n){a.upload(e,function(i,o){var a;switch(i){case 0:a="烧写成功",n.isBuilding=!1;break;case 1:a="找不到串口",n.isBuilding=!1;break;case 2:a="请选择串口：";for(var r=$('<select class="portList">'),c=0;c<o.length;c++){var s=o[c];$("<option>").text(s.path).attr("title",s.displayName).appendTo(r)}a+=r.prop("outerHTML"),n.resume=!0,n.url=e;break;case 3:a="连接失败",n.isBuilding=!1;break;case 4:default:a="烧写失败",n.isBuilding=!1}t.html(a)})}function x(){var e=g(),t=e.id;0==t?k():j(t)}function k(){var e=n.dialog(".save-dialog"),t=g(),i=$("form",e);$('input[name="name"]',i).val(t.project_name),$('textarea[name="intro"]',i).val(t.project_intro),$('input[name="public-type"][value="'+t.public_type+'"]',i).attr("checked",!0),$(".save-btn",i).off("click").on("click",function(){j(0)})}function j(e,a,r){a=0!=a;var c;if(0==e){var s=$(".save-dialog"),u=$("form",s),d=$('input[name="name"]',u).val();c={id:e,project_name:d,user_id:o.getUserId(),project_intro:$('textarea[name="intro"]',u).val(),project_data:JSON.stringify(_()),public_type:$("input[name='public-type']:checked",u).val()},$(".x-dialog-close",s).click()}else c={id:e,user_id:o.getUserId(),project_data:JSON.stringify(_())};return c.project_data.length>t.project.maxCodeLength?void n.showMessage("代码太长"):void i.save(c).done(function(t){if(0==t.status&&0==e){var i=g();i.id=t.data.project_id,i.project_name=c.project_name,i.project_intro=c.project_intro,i.public_type=c.public_type}a&&n.message(t.message),r&&r(t.status)})}function y(e,t){if(!T){T=!0;var n=t.hash,o=t.action,a=function(){if("create"==o)return I=!0,void O().reload();if(n)return void i.get(n,"hash").done(C);var e=I?b():w();v(e)};setTimeout(a,100)}}function C(e){return 0!=e.status?(n.message(e.message),void v()):void v(p(e.data))}function w(){var e=-1,t=0;return U.forEach(function(n,i){n.updated_at>t&&(t=n.updated_at,e=i)}),e>=0?U[e]:b()}function b(){return{id:0,user_id:o.getUserId(),project_name:"我的项目",project_intro:"我的项目简介",public_type:2,project_data:{}}}function _(){return O().getProject()}function O(){return angular.element("#api-controller").scope().getApi()}var T,I,U=[];return{init:r,create:c,save:u,upload:s,loadMyProject:l}}),define("app/topMenu",["./EventManager","./project"],function(e,t){function n(){$(".top-menu > ul > li,.sidebar > ul > li").on("click",i)}function i(e){var t=$(this),n=(t.index(),t.data("action"));switch(n){case"new":o();break;case"save":a();break;case"upload":r()}}function o(){t.create()}function a(){t.save()}function r(){t.upload()}return{init:n}}),define("app/guide",["vendor/jquery.cookie","./util"],function(e,t){function n(){a=$(".guide-cover"),$.cookie("has_visit")||($(window).on("keyup",o),a.addClass("active").on("click",o),$(".guide-skip",a).on("click",i),o())}function i(e){$(".guide-highlight").removeClass("guide-highlight"),$(window).off("keyup",o),$(".guide-skip",a).off("click",i),a.off("click",o).removeClass("active").remove(),a=null,$.cookie("has_visit",!0,{expires:365})}function o(e){var n=(new Date).getTime();if(!(r&&r+1e3>n||e&&e.keyCode&&32!=e.keyCode)){r=n;var o=$(".guide-step",a),c=o.filter(".active").index();if(c+=1,c<o.length){a.show(),$(".guide-highlight").removeClass("guide-highlight");var s=o.eq(c);t.toggleActive(s);var u=$(s.data("target"));u.addClass("guide-highlight"),(1==c||2==c)&&$(">button",u).click()}else i()}}var a,r;return{init:n}}),define("app/app-index",["./EventManager","./util","./user","./project","./topMenu","./config","./ext/agent","./guide"],function(e,t,n,i,o,a,r,c){function s(){a.pc||u(),a.pc&&d(),i.loadMyProject().done(function(){angular.bootstrap(".ng-app",["kenrobot"]),r.init(a.extension),n.init(),i.init(),o.init(),c.init()})}function u(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})}function d(){var e=function(e){t.dispatchEvent("app:openUrl",{url:e})};$("a.open-browser").on("click",function(){return e($(this).attr("href")),!1})}return{init:s}}),require.config({baseUrl:"assets/js",shim:{"vendor/ace/theme-default":{deps:["./ace"]},"vendor/ace/mode-arduino":{deps:["./ace"]},"vendor/ace/snippets/text":{deps:["../ace"]},"vendor/ace/snippets/arduino":{deps:["../ace","./text"]},"vendor/ace/ext-language_tools":{deps:["./ace","./theme-default","./mode-arduino","./snippets/text","./snippets/arduino"]}}}),require(["./app/app-index"],function(e){e.init()}),define("index",function(){});