require(["./common"],function(){require(["../app/app-index"],function(e){e.init()})}),define("../index",function(){}),define("../app/config",[],function(){return{showFirstVisitHint:!0,buildAuth:!0,extension:{appId:"hhgmonhbodfiplppmcangkmlfkcnilpd",launchAuth:!0,debugUrl:"http://platform.kenrobot.com/extension/debug",burnUrl:"http://platform.kenrobot.com/extension/burn",burnDelay:250}}}),define("../app/EventManager",[],function(){function e(e,t){return e+"_"+t}function t(t,n,o){var i=e(t,n),r=a[i];r||(r=[],a[i]=r),r.push(o)}function n(t,n,o){var i=e(t,n),r=a[i];if(r)for(var l=0;l<r.length;l++){var c=r[l];if(c==o){r.splice(l,1);break}}}function o(t,n,o){var i=e(t,n),r=a[i];if(r)for(var l=0;l<r.length;l++){var c=r[l];c(o)}}var a={};return{bind:t,unbind:n,trigger:o}}),define("../app/nodeTemplate",["go","./EventManager"],function(e,t){function n(){var e=new go.Size(9,15),t=new go.Size(14,14),n=3,r={ArduinoUNO:f(go.Node,"Spot",o(),a(),i("0",new go.Spot(.947,.037),"Rectangle","#F1C933",e),i("1",new go.Spot(.912,.037),"Rectangle","#F1C933",e),i("2",new go.Spot(.877,.037),"Rectangle","#F1C933",e),i("3",new go.Spot(.842,.037),"Rectangle","#F1C933",e),i("4",new go.Spot(.807,.037),"Rectangle","#F1C933",e),i("5",new go.Spot(.772,.037),"Rectangle","#F1C933",e),i("6",new go.Spot(.737,.037),"Rectangle","#F1C933",e),i("7",new go.Spot(.702,.037),"Rectangle","#F1C933",e),i("8",new go.Spot(.653,.037),"Rectangle","#F1C933",e),i("9",new go.Spot(.618,.037),"Rectangle","#F1C933",e),i("10",new go.Spot(.583,.037),"Rectangle","#F1C933",e),i("11",new go.Spot(.548,.037),"Rectangle","#F1C933",e),i("12",new go.Spot(.513,.037),"Rectangle","#F1C933",e),i("13",new go.Spot(.478,.037),"Rectangle","#F1C933",e),i("A0",new go.Spot(.771,.984),"Rectangle","#F1C933",e),i("A1",new go.Spot(.806,.984),"Rectangle","#F1C933",e),i("A2",new go.Spot(.841,.984),"Rectangle","#F1C933",e),i("A3",new go.Spot(.876,.984),"Rectangle","#F1C933",e),i("A4",new go.Spot(.911,.984),"Rectangle","#F1C933",e),i("A5",new go.Spot(.946,.984),"Rectangle","#F1C933",e),i("SerialPort",new go.Spot(.0089,.248),"Rectangle","#F1C933",new go.Size(30,65))),"one-port-top":f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(.5,0,0,-n),null,"#F1C933",t,"#F19833")),"one-port-bottom":f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(.5,1,0,n),null,"#F1C933",t,"#F19833")),"one-port-right":f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(1,.5,n,0),null,"#F1C933",t,"#F19833")),"two-port-top":f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(.333,0,0,-n),null,"#F1C933",t,"#F19833"),i("P1",new go.Spot(.667,0,0,-n),null,"#F1C933",t,"#F19833")),"two-port-bottom":f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(.333,1,0,n),null,"#F1C933",t,"#F19833"),i("P1",new go.Spot(.667,1,0,n),null,"#F1C933",t,"#F19833")),joystick:f(go.Node,"Spot",o(),a(),i("P0",new go.Spot(.5,0,0,-n),null,"#F1C933",t,"#F19833"),i("P1",new go.Spot(.333,1,0,n),null,"#F1C933",t,"#F19833"),i("P2",new go.Spot(.667,1,0,n),null,"#F1C933",t,"#F19833"))},l=f(go.Link,{routing:go.Link.AvoidsNodes,corner:5,click:c},new go.Binding("points").makeTwoWay(),f(go.Shape,{name:"LINE",isPanelMain:!0,fill:"#95a3ad",stroke:"#95a3ad",strokeWidth:3})),s=f(go.Adornment,"Auto",f(go.Shape,{fill:null,stroke:"#1ca8f8",strokeWidth:2}),f(go.Placeholder)),d=f(go.Adornment,"Link",f(go.Shape,{isPanelMain:!0,stroke:"#F19833",strokeWidth:0}));return{node:r,link:l,nodeSelection:s,linkSelection:d}}function o(){return[new go.Binding("location","location",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("selectable"),new go.Binding("deletable"),new go.Binding("angle").makeTwoWay(),{cursor:"pointer",locationSpot:go.Spot.Center,click:r,doubleClick:l,toolTip:f(go.Adornment,"Auto",f(go.Shape,{fill:"#F1C933",stroke:null}),f(go.TextBlock,{margin:10,font:p,stroke:"#69550B"},new go.Binding("text","label")))}]}function a(){return f(go.Picture,new go.Binding("source"),new go.Binding("width"),new go.Binding("height"))}function i(e,t,n,o,a,i){return f(go.Shape,n||"Circle",{name:"PORT",fromLinkable:!0,toLinkable:!0,portId:e,alignment:t,alignmentFocus:t,fill:o||"transparent",desiredSize:a||new go.Size(5,5),stroke:i||null,cursor:"crosshair",click:s,mouseEnter:d,mouseLeave:u,toolTip:f(go.Adornment,"Auto",f(go.Shape,{fill:"#F1C933",stroke:null}),f(go.TextBlock,{margin:10,font:p,stroke:"#69550B"},new go.Binding("text","",function(t){var n=t.ports,o=n[e];return"component"==t.type||3==o.type?o.label:"Pin "+o.label})))})}function r(e,n){t.trigger("hardware","nodeClick",n),e.handled=!0}function l(e,n){"board"==n.data.type&&t.trigger("project","switchPanel",1)}function c(e,n){t.trigger("hardware","linkClick",n),e.handled=!0}function s(e,n){t.trigger("hardware","portClick",n),e.handled=!0}function d(e,t){g=t.fill,t.fill=v}function u(e,t){t.fill=g}var f=go.GraphObject.make,p="14px Microsoft Yahei",g="#ffe42b",v="#F19833";return n()}),define("../app/util",["jquery"],function(e){function t(t){var n=400;e("div.x-message").stop(!0).fadeOut(n/2,function(){e(this).remove()}),t="string"==typeof t?{text:t}:t;var o=t.type||"info",a=t.text,i='<div class="x-message alert alert-'+o+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+a+"</div>",r=e(i);r.appendTo(e("body")).css({left:(e(window).width()-r.width())/2,top:-r.height()}).animate({top:150},n,"swing").delay(2e3).fadeOut(n,function(){e(this).remove()})}function n(t){t="string"==typeof t?{text:t}:t;var n=t.type||"confirm",o=t.title;o||(o="confirm"==n?"确认":"信息提示");var a=t.text,i=t.ok||"确 认",r=t.cancel||"取 消",l=t.okFunc,c=t.cancelFunc,s='<div class="x-confirm x-confirm-'+n+'">			<div class="x-confirm-title">'+o+'</div>			<div class="x-confirm-close">&times;</div>			<div class="x-confirm-content">'+a+'</div>			<div class="x-confirm-btns">'+("confirm"==n?'<button class="x-confirm-btn cancel">'+r+"</button>":"")+'<button class="x-confirm-btn confirm">'+i+"</button>			</div>		</div>",d=e(s);t.cls&&d.addClass(t.cls),t.contentCls&&e(".x-confirm-content",d).addClass(t.contentCls);var u=function(){d.slideUp(200,function(){d.remove(),e(".dialog-layer").removeClass("active")})};e(".x-confirm-btns .confirm",d).on("click",function(){u(),l&&l()}),e(".x-confirm-close,.x-confirm-btns .cancel",d).on("click",function(){u(),c&&c()}),d.appendTo(e(".dialog-layer")).css({top:-d.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function o(e,t,n){return t=t||"li",n?e.hasClass("active")?(e.removeClass("active"),!1):(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0):e.hasClass("active")?!1:(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0)}return{message:t,confirm:n,toggleActive:o}}),define("../app/hardware",["jquery","jquery-ui","jquery.cookie","go","./nodeTemplate","./EventManager","./util"],function(e,t,t,t,n,o,a){function i(){W=go.GraphObject.make,z=W(go.Diagram,Q,{initialContentAlignment:go.Spot.Center,allowClipboard:!1,allowCopy:!1,allowTextEdit:!1,allowReshape:!1,allowRelink:!1,allowLink:!0,maxSelectionCount:1,"toolManager.hoverDelay":500,"clickCreatingTool.isEnabled":!1,"clickCreatingTool.isDoubleClick":!1,"linkingTool.portGravity":50,"linkingTool.linkValidation":R,"relinkingTool.linkValidation":R,"grid.visible":!0,"toolManager.mouseWheelBehavior":go.ToolManager.WheelZoom,"dragSelectingTool.isEnabled":!1,"animationManager.isEnabled":!1,click:N,doubleClick:I,contextClick:M,PartCreated:q}),z.grid=W(go.Panel,"Grid",W(go.Shape,"LineH",{stroke:"#EBEFF7"}),W(go.Shape,"LineV",{stroke:"#EBEFF7"}),W(go.Shape,"LineH",{stroke:"#F0F3F8",interval:5}),W(go.Shape,"LineV",{stroke:"#F0F3F8",interval:5}));for(var e in n.node){var t=n.node[e];z.nodeTemplateMap.add("default"==e?"":e,t)}z.linkTemplate=n.link,z.nodeSelectionAdornmentTemplate=n.nodeSelection,z.linkSelectionAdornmentTemplate=n.linkSelection,z.toolManager.linkingTool.temporaryLink=W(go.Link,W(go.Shape,{stroke:"#95a3ad",strokeWidth:2}));var o=W(go.Node,W(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));z.toolManager.linkingTool.temporaryFromNode=o,z.toolManager.linkingTool.temporaryFromPort=o.port;var a=W(go.Node,W(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));z.toolManager.linkingTool.temporaryToNode=a,z.toolManager.linkingTool.temporaryToPort=a.port;var i=z.toolManager.clickCreatingTool;i.insertPart=function(e){return this.archetypeNodeData=P(this.archetypeNodeData.name),go.ClickCreatingTool.prototype.insertPart.call(this,e)},i=z.toolManager.linkingTool,i.doActivate=function(){var e=this.findLinkablePort();return j(e),go.LinkingTool.prototype.doActivate.call(this)},i.doDeactivate=function(){var e=go.LinkingTool.prototype.doDeactivate.call(this);return j(),e};var r=W(go.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort"});z.model=r,Z={},f(),g(ee)}function r(e){$=e}function l(){return{model:z.model.toJson(),componentConuts:componentConuts}}function c(e){e=e||{},e.model?z.model=go.Model.fromJson(e.model):(z.clear(),w()),componentConuts=e.componentConuts||[],j(),S(),F(!1)}function s(){return ee}function d(e){if("modern"==ee){var t=z.toolManager.clickCreatingTool;t.isEnabled=!0,t.archetypeNodeData={name:e};var n=T(e);G.attr("src",n.source).css({width:n.width,height:n.height,left:-999}),v()}}function u(){for(var e,t,n,o,a,i,r=[],l=x(),c=l.findNodesConnected().iterator;c.next();){for(e=c.value,t=e.data,n=[],a=l.findLinksBetween(e).iterator;a.next();)o=a.value,i=o.fromPort.part.data.type,"board"==i?n.push({source:o.toPort.portId,target:o.fromPort.portId}):n.push({source:o.fromPort.portId,target:o.toPort.portId});r.push({name:t.name,headCode:t.headCode,varCode:t.varCode,setupCode:t.setupCode,varName:t.varName,ports:n})}return r.sort(function(e,t){var n=e.name.localeCompare(t.name);return 0==n?e.varName.localeCompare(t.varName):n})}function f(){K=e("#"+Q).droppable({disabled:!0,scope:"hardware",drop:U}),G=e(".hardware .follow .follower"),e(".hardware .tools .interactive-mode > li").on("click",k),e(".hardware .tools .mode > li").on("click",b),o.bind("hardware","nodeClick",B),o.bind("hardware","linkClick",E),o.bind("hardware","portClick",O)}function p(t){e('.hardware .tools .mode li[data-mode="'+t+'"').click()}function g(t){"drag"==t?e('.hardware .tools .interactive-mode li[data-mode="modern"]').click():e('.hardware .tools .interactive-mode li[data-mode="drag"]').click()}function v(e){if(K.off("mousemove",m),G.css({left:-999}),"modern"==ee&&("default"==te||"clone"==te)&&(void 0!==e||z.toolManager.clickCreatingTool.isEnabled)){if(0==e)return void(z.toolManager.clickCreatingTool.isEnabled=!1);K.on("mousemove",m),K.off("mouseout").on("mouseout",h)}}function m(e){G.css({top:e.offsetY-G.height()/2,left:e.offsetX-G.width()/2})}function h(e){G.css({left:-999})}function b(t){var n=e(this);a.toggleActive(n),te=n.data("mode");var o=z.toolManager.clickCreatingTool,i="modern"==ee;switch(te){case"default":o.isEnabled=i;break;case"clone":o.isEnabled=i;break;case"delete":o.isEnabled=!1}v()}function k(t,n){var a=e(this).addClass("hide"),i=a.data("mode"),r=e('.hardware .tools .mode li[data-mode="clone"]');"drag"==i?(ee="modern",a.parent().find('li[data-mode="'+ee+'"]').removeClass("hide"),r.removeClass("hide")):(ee="drag",a.parent().find('li[data-mode="'+ee+'"]').removeClass("hide"),r.addClass("hide")),K.droppable("option","disabled","drag"!=ee),p("default"),e.cookie("interactiveMode",ee),o.trigger("hardware","changeInteractiveMode",ee)}function w(){y("ArduinoUNO",0,0,!0)}function y(e,t,n,o){var a=P(e,o);"number"==typeof t&&"number"==typeof n&&(a.location=t+" "+n);var i=z.model;return i.addNodeData(a),a}function C(e,t,n,o){var a={from:e,to:t,fromPort:n,toPort:o},i=z.model;return i.addLinkData(a),a}function x(){for(var e,t=z.nodes.iterator;t.next();)if(e=t.value,"board"==e.data.type)return e}function j(e){var t=x();if(t){for(var n,o=t.ports.iterator;o.next();)n=o.value,D(n)?n.fill="#4891ed":n.fill="#ffe42b";if(J&&J.diagram&&(J.fill="#F1C933"),J=e){J.fill="#F19833";var a=J.part.data.type;if("component"==a)for(o.reset();o.next();)n=o.value,(D(n)||!A(J,n))&&(n.fill="#4891ed")}}}function S(e){H&&H.diagram&&(H.fromPort.fill="#F1C933",H.toPort.fill="#4891ed"),H=e,H&&(H.fromPort.fill="#F19833",H.toPort.fill="#F19833")}function F(t){var n=e(".hardware .name-dialog");if(t){var o=e(".name",n).val(t.varName).off("blur").on("blur",function(e){var n=V(t.key,o.val());n.success||(o.val(t.varName),a.message(n.message))});if("block"==n.css("display")){var i=V(t.key,o.val());i.success||(o.val(t.varName),a.message(i.message))}n.show()}else n.hide()}function T(e,t){return t?$.boards[e]:$.components[e]}function P(t,n){var o=T(t,n),a=e.extend(!0,{},o),i=(new Date).getTime();a.key=t+"_"+i;var r=Z[t]||0;return a.varName+=r,r++,Z[t]=r,a}function L(e){var t=e.part,n=t.data.ports;return n[e.portId]}function _(e){var t=e.part,n=t.findLinksConnected(e.portId).iterator;return n.next(),n.value}function A(e,t){var n=L(e),o=L(t);return n.type==o.type}function D(e){var t=e.part;return t.findLinksConnected(e.portId).count>0}function N(e){j(),S(),F(!1)}function I(e){o.trigger("project","switchPanel",1)}function M(e){p("default"),v(!1)}function q(e){"default"==te&&(z.toolManager.clickCreatingTool.isEnabled=!1),v()}function B(e){if(j(),S(),"default"==te){var t=e.data,n=t.type;F("component"==n?{varName:t.varName,key:t.key}:!1)}else"delete"==te?(F(!1),e.deletable&&z.remove(e)):F(!1)}function E(e){j(),F(!1),"delete"==te?(e==H&&(S(),H=null),z.remove(e)):("default"==te||"clone"==te)&&S(e)}function O(e){if(S(),F(!1),"modern"==ee&&"default"==te){var t=e.part,n=t.data.type;if(J){var o=J.part.data.type;if("component"==o)if("component"==n){if(!D(J)||D(e))return void j();var a=_(J),i=a.getOtherPort(J);if(!A(e,i))return void j();z.remove(a);var r=i.part.data.key,l=e.part.data.key;C(r,l,i.portId,e.portId),j()}else{if(D(J)||D(e)||!A(J,e))return void j();var r=J.part.data.key,l=e.part.data.key;C(r,l,J.portId,e.portId),j()}else if("component"==n){if(D(J)||D(e)||!A(J,e))return void j();var r=J.part.data.key,l=e.part.data.key;C(r,l,J.portId,e.portId),j()}else{if(!D(J)||D(e))return void j();var a=_(J),i=a.getOtherPort(J);if(!A(e,i))return void j();z.remove(a);var r=i.part.data.key,l=e.part.data.key;C(r,l,i.portId,e.portId),j()}}else j(e)}else j()}function R(e,t,n,o){return!D(t)&&!D(o)&&A(t,o)}function U(t,n){var o=n.helper.first(),a=o.data("component-name"),i=o.width(),r=o.height(),l=o.offset().left+i/2,c=o.offset().top+r/2,s=T(a);switch(s.category){case"one-port-top":case"two-port-top":c-=3.5;break;case"one-port-bottom":case"two-port-bottom":c+=3.5;break;case"one-port-right":l+=3.5}var d=e(z.div).offset(),u=new go.Point(l-d.left,c-d.top);u=z.transformViewToDoc(u),y(a,u.x,u.y)}function V(e,t){if(""==t)return{message:"变量名不能为空",success:!1};if(X.indexOf(t)>=0)return{message:"变量名不能是关键字",success:!1};if(!Y.test(t))return{message:"变量名只能由字母、数字或下划线组成，且不能以数字开头",success:!1};for(var n=z.model.nodeDataArray,o=0;o<n.length;o++){var a=n[o];if(a.key!=e&&a.name==t)return{message:"变量名重复",success:!1}}var a=z.model.findNodeDataForKey(e);return a?(a.varName=t,{success:!0}):{message:"非法操作",success:!0}}var W,z,$,K,G,J,H,Z,X=["asm","do","if","return","typedef","auto","double","inline","short","typeid","bool","dynamic_cast","int","signed","typename","break","else","long","sizeof","union","case","enum","mutable","static","unsigned","catch","explicit","namespace","static_cast","using","char","export","new","struct","virtual","class","extern","operator","switch","void","const","false","private","template","volatile","const_cast","float","protected","this","wchar_t","continue","for","public","throw","while","default","friend","register","true","delete","goto","reinterpret_cast","try","_Bool","_Complex","_Imaginary"],Y=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Q="hardware-container",ee=e.cookie("interactiveMode")||"modern",te="default";return{init:i,load:r,getData:l,setData:c,getInteractiveMode:s,setPlaceComponent:d,getNodes:u}}),define("../app/user",["jquery","./EventManager","./util"],function(e,t,n){function o(){c(),s()}function a(){return f?f.id:0}function i(){return f}function r(t){e.ajax({type:"GET",url:"/auth/check",dataType:"json"}).done(function(e){var n=0==e.code;f=n?e.user:null,t&&t(n)})}function l(t,o){var a=e("#login_dialog");e(".qrLoginBtn, .baseLoginBtn",a).off("click").on("click",function(n){var o=e(this).data("action");"qrLogin"==o?(e(".qrLoginBtn, .qrLogin").removeClass("active"),e(".baseLoginBtn, .baseLogin").addClass("active"),e(".qrLoginBtn").css({display:"none"}),e(".baseLoginBtn").css({display:"block"}),e("#use_weixin").removeClass("active"),d(!1)):(e(".baseLoginBtn, .baseLogin").removeClass("active"),e(".qrLoginBtn, .qrLogin").addClass("active"),e(".baseLoginBtn").css({display:"none"}),e(".qrLoginBtn").css({display:"block"}),d(!0,t))}),e(".btn-login",a).off("click").on("click",function(){e.ajax({type:"POST",url:"/snspostlogin",dataType:"json",data:{email:e(".email",a).val(),password:e(".password",a).val()}}).done(function(o){0==o.code?(n.message(o.message),e("#login_dialog .close-btn").click(),f=o.data,u(),t&&t()):1==o.code||e(".baseLogin .message span").show().html(o.message).delay(2e3).queue(function(){e(this).fadeOut().dequeue()})})}),o=o||0,0==o?e(".qrLoginBtn").click():e(".baseLoginBtn").click(),a.css({top:-a.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function c(){var t=e("#login_dialog"),n=e("#use_weixin");e(".close-btn",t).on("click",function(o){t.slideUp(100,function(t,o){n.removeClass("active"),e(".dialog-layer").removeClass("active")}),d(!1)}),e(".qrLogin .qrcode").hover(function(t){var o=e(this).offset().top,a=e(this).offset().left;n.is(":animated")||n.addClass("active").show().css({top:o-160,left:a+50,opacity:0}).animate({left:a+260,opacity:1})},function(t){var o=e(this).offset().left;n.is(":animated")||n.animate({left:o+420,opacity:0},null,null,function(){n.removeClass("active").hide()})}),e("form",t).on("keyup",function(n){13==n.keyCode&&e(".baseLogin",t).hasClass("active")&&e(".btn-login",t).trigger("click")})}function s(){var t=e(".user"),n=e(".dialog",t),o=e(".indent",t),a=e(".software .back");e(".close-btn",n).on("click",function(){n.slideUp(200,function(e){o.show()}),a.removeClass("active")}),o.on("click",function(){n.slideDown(400,function(){o.hide()}),a.addClass("active")})}function d(o,a){clearInterval(p),o&&(p=setInterval(function(){var o=e("#qrcode_key").val();e.ajax({url:"/weixinlogin?key="+o,dataType:"json"}).done(function(o){0==o.code?(f=o.data,d(!1),n.message(o.message),e("#login_dialog .close-btn").click(),u(),a&&a(),t.trigger("user","login")):1==o.code&&(f=o.data,d(!1),u())})},3e3))}function u(){var t=e(".user"),n=e(".software .back");f?(t.addClass("active"),n.addClass("active"),e(".photo img",t).attr("src",f.avatar_url),e(".name",t).text(f.name)):(t.removeClass("active"),n.removeClass("active"),e(".name",t).text(""),e(".photo img",t).attr("src","#"))}var f,p;return{init:o,getUserId:a,getUserInfo:i,authCheck:r,showLoginDialog:l}}),define("../app/code",[],function(){function e(e){s=e}function t(e){for(var t=e.split("\n"),n=0;n<t.length;n++){var o=t[n];""!=o&&p.indexOf(o)<0&&p.push(o)}}function n(e){if(d=[],u=[],f=[],c(),e)return e=l(e,o(),"head"),e=l(e,a(),"variable"),e=l(e,i(),"setup");var t=g,n=o();""!=n&&(t+="\n"+n);var r=a();""!=r&&(t+="\n"+r+"\n"),t+="void setup() {\n";var s=i();return""!=s&&(t+=s),t+="    \n}\n\n",t+="void loop() {\n    \n}"}function o(){for(var e=0;e<p.length;e++){var t=p[e];""!=t&&d.indexOf(t)<0&&d.push(t)}d=d.sort(function(e,t){return e.localeCompare(t)});for(var n="",o="",e=0;e<d.length;e++)o+=d[e]+"\n";return n+=r(o,"head")}function a(){for(var e="",t="",n=0;n<u.length;n++)t+=u[n];return e+=r(t,"variable")}function i(){for(var e="",t="",n=0;n<f.length;n++)t+=f[n];return e+=r(t,"setup","    ")}function r(e,t,n){return n=n||"",v.replace("{{code}}",e).replace("{{tag}}",t).replace(/\{\{indent\}\}/g,n)}function l(e,t,n){var o="//end auto generate. block tag: "+n,a=e.indexOf(o);if(0>a)return e;var i="//auto generate",r=e.lastIndexOf(i,a);return 0>r?e:(r=e.lastIndexOf("\n",r)+1,a=a+o.length+1,e.replace(e.substring(r,a),t))}function c(){for(var e=s(),t=0;t<e.length;t++){var n=e[t];if(""!=n.headCode)for(var o=n.headCode.split("\n"),a=0;a<o.length;a++){var i=o[a];""!=i&&d.indexOf(i)<0&&d.push(i)}var r,l=n.ports,c=n.varCode;if(""!=c){c=c.replace(/\$NAME/g,n.varName);for(var a=0;a<l.length;a++)r=l[a],c=c.replace("$"+r.source,r.target);u.push(c)}var p=n.setupCode;if(""!=p){p=p.replace(/\$NAME/g,n.varName);for(var a=0;a<l.length;a++)r=l[a],p=p.replace("$"+r.source,r.target);p=p.replace(/([^\n]*\n)/g,"    $1"),f.push(p)}}}var s,d,u,f,p=[],g="/************************************************************\n *Copyright(C), 2016-2038, KenRobot.com\n *FileName:  //文件名\n *Author:    //作者\n *Version:   //版本\n *Date:      //完成日期\n */\n",v="{{indent}}//auto generate\n{{indent}}//warning: please don't modify\n{{code}}{{indent}}//end auto generate. block tag: {{tag}}\n";return{init:e,gen:n,addLibrary:t}}),define("../app/software",["ace/ace","ace/ext-language_tools","jquery","./EventManager","./code"],function(e,e,t,n,o){function a(e){s=ace.edit(t(".software .editor")[0]),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),s.setShowPrintMargin(!1),s.$blockScrolling=1/0,s.setTheme("ace/theme/default"),s.session.setMode("ace/mode/arduino"),t(".software .back").on("click",function(e){n.trigger("project","switchPanel",0)}),o.init(e)}function i(e){e=e||{};var t=e.source||o.gen();s.setValue(t,1)}function r(){return{source:s.getValue()}}function l(){s.setValue(o.gen(s.getValue()),1)}function c(e){o.addLibrary(e.code)}var s;return{init:a,getData:r,setData:i,gen:l,addLibrary:c}}),define("../app/board",["jquery","./util"],function(e,t){function n(){s=".board .list > li.normal",e(s).on("click",r)}function o(t){c=t,e(s).eq(0).click()}function a(){return{id:l.id,name:l.name,board_type:l.board_type}}function i(t){t=t||{};var n=t.id||1;for(var o in c){var a=c[o];if(a.id==n){e(s).filter('[data-board="'+o+'"]').click();break}}}function r(n){var o=e(this),a=o.data("board");l=c[a],t.toggleActive(o)}var l,c,s;return{init:n,load:o,getData:a,setData:i}}),define("../app/project",["jquery","./EventManager","./util","./config","./user","./hardware","./software","./board"],function(e,t,n,o,a,i,r,l){function c(){e(".project .operation li").on("click",h),t.bind("project","switchPanel",j),t.bind("user","login",S),u()}function s(t){var n=function(){var n=_.project_name,o=l.getData(),a=r.getData();e.ajax({type:"POST",url:"/build",data:{source:a.source,project_name:n,build_type:"Arduino",board_type:o.board_type},dataType:"json"}).done(function(e){t&&t(e)})};o.buildAuth?a.authCheck(function(e){return e?void n():void a.showLoginDialog(n)}):n()}function d(t){var n=e("#save-dialog"),o=e("form",n),a=t?P():_;e('input[name="name"]',o).val(a.project_name),e('textarea[name="intro"]',o).val(a.project_intro),e('input[name="public-type"][value="'+a.public_type+'"]',o).attr("checked",!0);var i=t?"创建项目":"保存项目";e('input[name="save"]',o).val(i),e(".close-btn",n).off("click").on("click",function(t){n.slideUp(100),e(".dialog-layer").removeClass("active")}),e(".save",n).off("click").on("click",function(){p(a.id)}),n.css({top:-n.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function u(){a.authCheck(function(t){t?e.ajax({url:"/projects/"+a.getUserId(),dataType:"json"}).done(f):(A.push(P()),x(0))})}function f(t){A=0!=t.status?[]:t.data,0==A.length&&A.push(P());for(var n=e(".project .list ul").empty(),o=0;o<A.length;o++){var a=A[o];try{a.project_data=JSON.parse(a.project_data)}catch(i){console.log(i.message),a.project_data={}}n.append(T(a))}x(-1)}function p(t){var o=e("#save-dialog form"),i={id:t,project_name:e('input[name="name"]',o).val(),user_id:a.getUserId(),project_intro:e('textarea[name="intro"]',o).val(),project_data:JSON.stringify(F()),public_type:e("input[name='public-type']:checked",o).val()};e("#save-dialog .close-btn").click(),e.ajax({type:"POST",url:"/project/save",data:i,dataType:"json"}).done(function(o){n.message(o.message),0==o.status&&e.ajax({url:"project/"+o.data.project_id,dataType:"json"}).done(function(e){g(t,e)})})}function g(t,o){if(0!=o.status)return void n.message(o.message);var a=o.data,i=e(".project .list > ul");if(0==t){i.find('> li[data-project-id="0"]').remove();for(var r=0;r<A.length;r++){var l=A[r];if(0==l.id){A.splice(r,1);break}}A.push(a),i.append(T(a)),_=a,x(-1)}else{for(var c=-1,r=0;r<A.length;r++){var l=A[r];if(l.id==a.id){c=r;break}}A[c]=a,i.find('> li[data-project-id="'+a.id+'"]').find(".name").text(a.project_name),_=a}}function v(t){var o=e(this).parent(),a=e(".sidebar .project .list").data("operation");if("delete"==a);else if(_&&(_.project_data=F()),n.toggleActive(o,null,!0)){var c=o.data("project-id");_=0==c?P():L(c);var s=_.project_data;l.setData(s.board),i.setData(s.hardware),r.setData(s.software);var d=o.find(".view > div");0==d.filter(".active").length?d.eq(0).click():d.filter(".active").click()}}function m(t){var o=_.project_data,a=e(this);n.toggleActive(a,"div");var l=a.index(),c=e(".sidebar .bar ul > li"),s=e(".sidebar .tab");if(0==l){c.filter('[data-action="board"],[data-action="component"]').removeClass("hide"),c.filter('[data-action="library"]').addClass("hide"),s.filter(".tab-board,.tab-component").removeClass("hide"),s.filter(".tab-library").addClass("hide");var d=c.filter('[data-action="component"]');d.hasClass("active")||d.click(),o.software=r.getData()}else{c.filter('[data-action="board"],[data-action="component"]').addClass("hide"),c.filter('[data-action="library"]').removeClass("hide"),s.filter(".tab-board,.tab-component").addClass("hide"),s.filter(".tab-library").removeClass("hide");var u=c.filter('[data-action="project"]');u.hasClass("active")||u.click(),o.hardware=i.getData(),r.gen()}e(".main > .tabs").css({"margin-left":e(".sidebar").width()}),e(".main > .tabs .tab").removeClass("active").eq(l).addClass("active")}function h(t){var n=e(this),o=n.data("action");switch(o){case"new":b();break;case"delete":k();break;case"cancel":y();break;case"confirm":C()}}function b(e){a.authCheck(function(e){e?d(!0):a.showLoginDialog()})}function k(e){return 0==_.id?void n.message("你的项目尚未保存"):void a.authCheck(function(e){if(e){var t=function(){w(_.id)};n.confirm({title:"删除确认",text:"删除后不可恢复，确定要删除该项目吗？",okFunc:t})}else a.showLoginDialog()})}function w(t){e.ajax({type:"POST",url:"/project/delete",data:{id:t,user_id:a.getUserId()},dataType:"json"}).done(function(o){if(n.message(o.message),0==o.status){for(var a=(e('.project .list > ul > li[data-project-id="'+t+'"]').remove(),0);a<A.length;a++){var i=A[a];if(i.id==t){A.splice(a,1);break}}if(console.log("aaaaaaaa"+A.length),0==A.length){var r=P();A.push(r),e(".project .list > ul").append(T(r)),x(-1)}else{var l=e(".project .list .title");l.eq(l.length-1).click()}}})}function y(e){}function C(e){}function x(t){e(".project .list .view > div").off("click").on("click",m);var n=e(".project .list .title").off("click").on("click",v);"number"==typeof t&&(-1==t?n.eq(n.length-1).click():e('.project .list >  ul > li[data-project-id="'+t+'"] .title').click())}function j(t){e(".project .list .view > div.active").parent().find("div").eq(t).click()}function S(){e.ajax({url:"/projects/"+a.getUserId(),dataType:"json"}).done(f)}function F(){return{board:l.getData(),hardware:i.getData(),software:r.getData()}}function T(e){return D.replace(/\{\{project_name\}\}/g,e.project_name).replace(/\{\{id\}\}/g,e.id)}function P(){return{id:0,user_id:a.getUserId(),project_name:"我的项目",project_intro:"我的项目简介",public_type:1,project_data:{}}}function L(e){for(var t=0;t<A.length;t++){var n=A[t];if(n.id==e)return n}}var _,A=[],D='<li data-project-id="{{id}}"><div class="title"><span class="name">{{project_name}}</span><i class="iconfont icon-lashenkuangxiangxia"></i></div><div class="view"><div><span class="name">{{project_name}}</span>.uno</div><div><span class="name">{{project_name}}</span>.ino</div></div></li>';return{init:c,build:s,showSaveDialog:d}}),define("../app/extAgent",["jquery.cookie","./config","./util","./user","./project"],function(e,t,n,o,a){function i(e){var a=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;return a||window.chrome?void l(function(n){if(!n)return void g();var a=function(){r(e)};t.extension.launchAuth?o.authCheck(function(e){e?a():o.showLoginDialog(a)}):a()}):void n.message("Kenrobot平台扩展目前只支持Chrome浏览器，其它浏览器敬请期待！")}function r(e){clearInterval(m),window.location=e,h=[],m=setInterval(c,1e3)}function l(e){chrome.runtime.sendMessage(t.extension.appId,"isInstalled",function(t){e(t&&"isInstalled"==t.action&&1==t.result?!0:!1)})}function c(){var e=h.length>0?h.shift():"nothing";s(e)}function s(e){chrome.runtime.sendMessage(t.extension.appId,e,d)}function d(e){if(e&&"nothing"!=e)for(var t=$.isArray(e)?e:[e],n=0;n<t.length;n++){var o=t[n],a=o.action;"init"==a?u(o):"build"==a?f(o):"setCookie"==a?p(o):"arduinoDriver"==a&&v()}}function u(e){var n;try{n=JSON.parse($.cookie("serial-"+e.id))}catch(o){n={}}h.push({action:e.action,result:{host:window.location.protocol+"//"+window.location.host,cookie:n,config:{arduinoDriverUrl:t.extension.arduinoDriverUrl,burnDelay:t.extension.burnDelay}}})}function f(e){a.build(function(t){h.push({action:e.action,result:t})})}function p(e){$.cookie("serial-"+e.id,JSON.stringify(e.cookie)),h.push({action:e.action,result:!0})}function g(){n.confirm({title:"安装",cls:"extension-dialog",contentCls:"selectable",type:"info",text:'你没有安装啃萝卜<span class="strong">KenExt.crx</span>，请按以下步骤操作:<div class="step">Step 1: 点击<a href="http://platform.kenrobot.com/download/KenExt.crx" title="啃萝卜">下载</a><br />Step 2: 打开chrome浏览器，在地址栏输入<span class="strong">chrome://extensions</span><br />Step 3: 把<span class="strong">KenExt.crx</span>拖入浏览器<br />Step 4: 完成安装</div><div class="des">说明: 如果顶部弹出“无法添加来自此网站的应用...”，请点击确定。由于一些你懂的原因，我们不能把插件发布到google应用商店。就算能发布，部分用户也不能...，所以<span class="helpless">╮(╯▽╰)╭</span></div>'})}function v(){if(!b){var e;e=-1!=navigator.userAgent.indexOf("WOW64")||-1!=navigator.userAgent.indexOf("Win64")?64:32;var t="http://platform.kenrobot.com/download/arduino-driver-x"+e+".zip";n.confirm({title:"驱动问题",cls:"arduino-driver-dialog",contentCls:"selectable",type:"info",text:'如果你遇到了Arduino<span class="strong">驱动问题</span>，请按以下步骤操作:<div class="step">Step 1: 点击<a href="'+t+'" title="Arduino驱动">下载</a>并解压<br />Step 2: 运行<span class="strong">arduino驱动安装.exe</span><br />Step 3: 完成安装</div>',cancelFunc:function(){b=!1}}),b=!0}}var m,h,b;return{init:i}}),define("../app/sidebar",["jquery","./EventManager","./util","./config","./user","./project","./board","./software","./extAgent"],function(e,t,n,o,a,i,r,l,c){function s(){e(".sidebar .logo").on("click",d),e(".sidebar .bar ul > li").on("click",u).filter('[data-action="component"]').click()}function d(e){a.authCheck(function(e){e?n.message("你已登录"):a.showLoginDialog(null,1)})}function u(t){var o=e(this),a=(o.index(),o.data("action"));switch(a){case"save":f();break;case"download":p();break;case"serial":g();break;case"burn":v();break;default:var i=e(".sidebar .tab.tab-"+a);n.toggleActive(o,null,!0);n.toggleActive(i,".tab",!0);e(".main > .tabs").css({"margin-left":e(".sidebar").width()})}}function f(){a.authCheck(function(e){e?i.showSaveDialog():a.showLoginDialog(i.showSaveDialog)})}function p(){i.build(function(e){n.message(e.message),0==e.status&&e.url&&(window.location.href=e.url)})}function g(){c.init(o.extension.debugUrl)}function v(){c.init(o.extension.burnUrl)}return{init:s}}),define("../app/component",["jquery","jquery-ui","bootstrap-typeahead","./EventManager","./util","./hardware"],function(e,t,t,n,o,a){function i(){f=e(".component .items .list > li").on("click",c).draggable({disabled:!0,appendTo:".drag-layer",scope:"hardware",revert:!0,revertDuration:0,zIndex:9999,containment:"window",helper:s}),n.bind("hardware","changeInteractiveMode",l)}function r(e){u=e,d()}function l(e){f.draggable("option","disabled","drag"!=e)}function c(t){var n=e(this);
o.toggleActive(n),a.setPlaceComponent(n.data("component-name"))}function s(t){var n=e(this).data("component-name"),o=u[n];return e(".image",this).clone().css({width:o.width,height:o.height}).data("component-name",n)}function d(){var t=[];for(var n in u)t.push(u[n]);e(".search .key").typeahead({source:t,displayText:function(e){return"undefined"!=typeof e&&"undefined"!=typeof e.label&&e.label||e},updater:function(t){return e('.component .items .list > li[data-component-name="'+t.name+'"').click(),t}})}var u,f;return{init:i,load:r}}),define("../app/library",["jquery","./software"],function(e,t){function n(){e(".library .list > li").on("click",a)}function o(e){i=e}function a(n){var o=e(this),a=o.data("library"),r=i[a];r&&(t.addLibrary(r),t.gen())}var i;return{init:n,load:o}}),define("../app/app-index",["jquery","./config","./hardware","./user","./project","./software","./sidebar","./board","./component","./library"],function(e,t,n,o,a,i,r,l,c,s){function d(){f(),u(),o.init(),r.init(),l.init(),c.init(),s.init(),n.init(),i.init(n.getNodes),t.showFirstVisitHint?e(".login-hint-layer").on("click",function(){e(this).remove()}).show().delay(3e3).queue(function(){e(this).remove()}):e(".login-hint-layer").remove(),e.ajax({url:"/config",dataType:"json"}).done(p)}function u(){e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}})}function f(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?6518098de0bee39bef219952dbbae669";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function p(e){l.load(e.boards),c.load(e.components),s.load(e.libraries),n.load(e),a.init()}return{init:d}});