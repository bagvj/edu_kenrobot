require(["./common"],function(){require(["../app/app-index"],function(e){e.init()})}),define("../index",function(){}),define("../app/config",[],function(){return{buildAuth:!0,guide:{showIfFirstVisit:!0,autoNextDelay:3e3},extension:{appId:"hhgmonhbodfiplppmcangkmlfkcnilpd",launchAuth:!0,debugUrl:"http://platform.kenrobot.com/extension/debug",burnUrl:"http://platform.kenrobot.com/extension/burn",burnDelay:250}}}),define("../app/EventManager",[],function(){function t(e,t){return e+"_"+t}function n(n,r,i){var s=t(n,r),o=e[s];o||(o=[],e[s]=o),o.push(i)}function r(n,r,i){var s=t(n,r),o=e[s];if(!o)return;for(var u=0;u<o.length;u++){var a=o[u];if(a==i){o.splice(u,1);break}}}function i(n,r,i){var s=t(n,r),o=e[s];if(!o)return;for(var u=0;u<o.length;u++){var a=o[u];a(i)}}var e={};return{bind:n,unbind:r,trigger:i}}),define("../app/nodeTemplate",["go","./EventManager"],function(e,t){function a(){var e=new go.Size(9,15),t=new go.Size(14,14),r=3,i={ArduinoUNO:n(go.Node,"Spot",f(),l(),c("0",new go.Spot(.947,.037),"Rectangle","#F1C933",e),c("1",new go.Spot(.912,.037),"Rectangle","#F1C933",e),c("2",new go.Spot(.877,.037),"Rectangle","#F1C933",e),c("3",new go.Spot(.842,.037),"Rectangle","#F1C933",e),c("4",new go.Spot(.807,.037),"Rectangle","#F1C933",e),c("5",new go.Spot(.772,.037),"Rectangle","#F1C933",e),c("6",new go.Spot(.737,.037),"Rectangle","#F1C933",e),c("7",new go.Spot(.702,.037),"Rectangle","#F1C933",e),c("8",new go.Spot(.653,.037),"Rectangle","#F1C933",e),c("9",new go.Spot(.618,.037),"Rectangle","#F1C933",e),c("10",new go.Spot(.583,.037),"Rectangle","#F1C933",e),c("11",new go.Spot(.548,.037),"Rectangle","#F1C933",e),c("12",new go.Spot(.513,.037),"Rectangle","#F1C933",e),c("13",new go.Spot(.478,.037),"Rectangle","#F1C933",e),c("A0",new go.Spot(.771,.984),"Rectangle","#F1C933",e),c("A1",new go.Spot(.806,.984),"Rectangle","#F1C933",e),c("A2",new go.Spot(.841,.984),"Rectangle","#F1C933",e),c("A3",new go.Spot(.876,.984),"Rectangle","#F1C933",e),c("A4",new go.Spot(.911,.984),"Rectangle","#F1C933",e),c("A5",new go.Spot(.946,.984),"Rectangle","#F1C933",e),c("SerialPort",new go.Spot(.0089,.248),"Rectangle","#F1C933",new go.Size(30,65))),"one-port-top":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,0,0,-r),null,"#F1C933",t,"#F19833")),"one-port-bottom":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,1,0,r),null,"#F1C933",t,"#F19833")),"one-port-right":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(1,.5,r,0),null,"#F1C933",t,"#F19833")),"two-port-top":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.333,0,0,-r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.667,0,0,-r),null,"#F1C933",t,"#F19833")),"two-port-bottom":n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.333,1,0,r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.667,1,0,r),null,"#F1C933",t,"#F19833")),joystick:n(go.Node,"Spot",f(),l(),c("P0",new go.Spot(.5,0,0,-r),null,"#F1C933",t,"#F19833"),c("P1",new go.Spot(.333,1,0,r),null,"#F1C933",t,"#F19833"),c("P2",new go.Spot(.667,1,0,r),null,"#F1C933",t,"#F19833"))},s=n(go.Link,{routing:go.Link.AvoidsNodes,corner:5,click:d},(new go.Binding("points")).makeTwoWay(),n(go.Shape,{name:"LINE",isPanelMain:!0,fill:"#95a3ad",stroke:"#95a3ad",strokeWidth:3})),o=n(go.Adornment,"Auto",n(go.Shape,{fill:null,stroke:"#1ca8f8",strokeWidth:2}),n(go.Placeholder)),u=n(go.Adornment,"Link",n(go.Shape,{isPanelMain:!0,stroke:"#F19833",strokeWidth:0}));return{node:i,link:s,nodeSelection:o,linkSelection:u}}function f(){return[(new go.Binding("location","location",go.Point.parse)).makeTwoWay(go.Point.stringify),new go.Binding("selectable"),new go.Binding("deletable"),(new go.Binding("angle")).makeTwoWay(),{cursor:"pointer",locationSpot:go.Spot.Center,click:h,doubleClick:p,toolTip:n(go.Adornment,"Auto",n(go.Shape,{fill:"#F1C933",stroke:null}),n(go.TextBlock,{margin:10,font:r,stroke:"#69550B"},new go.Binding("text","label")))}]}function l(){return n(go.Picture,new go.Binding("source"),new go.Binding("width"),new go.Binding("height"))}function c(e,t,i,s,o,u){return n(go.Shape,i||"Circle",{name:"PORT",fromLinkable:!0,toLinkable:!0,portId:e,alignment:t,alignmentFocus:t,fill:s||"transparent",desiredSize:o||new go.Size(5,5),stroke:u||null,cursor:"crosshair",click:v,mouseEnter:m,mouseLeave:g,toolTip:n(go.Adornment,"Auto",n(go.Shape,{fill:"#F1C933",stroke:null}),n(go.TextBlock,{margin:10,font:r,stroke:"#69550B"},new go.Binding("text","",function(t){var n=t.ports,r=n[e];return t.type=="component"||r.type==3?r.label:"Pin "+r.label})))})}function h(e,n){t.trigger("hardware","nodeClick",n),e.handled=!0}function p(e,n){n.data.type=="board"&&t.trigger("project","switchPanel",1)}function d(e,n){t.trigger("hardware","linkClick",n),e.handled=!0}function v(e,n){t.trigger("hardware","portClick",n),e.handled=!0}function m(e,t){o=t.fill,t.fill=u}function g(e,t){t.fill=o}var n=go.GraphObject.make,r="14px Microsoft Yahei",i="#F1C933",s="#F19833",o="#ffe42b",u="#F19833";return a()}),define("../app/util",["jquery"],function(e){function t(t){var n=400;e("div.x-message").stop(!0).fadeOut(n/2,function(){e(this).remove()}),t=typeof t=="string"?{text:t}:t;var r=t.type||"info",i=t.text,s='<div class="x-message alert alert-'+r+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+i+"</div>",o=e(s);o.appendTo(e("body")).css({left:(e(window).width()-o.width())/2,top:-o.height()}).animate({top:150},n,"swing").delay(2e3).fadeOut(n,function(){e(this).remove()})}function n(t){t=typeof t=="string"?{text:t}:t;var n=t.type||"confirm",r=t.title;r||(r=n=="confirm"?"确认":"信息提示");var i=t.text,s=t.ok||"确 认",o=t.cancel||"取 消",u=t.okFunc,a=t.cancelFunc,f=t.closeFunc,l='<div class="x-confirm x-confirm-'+n+'">			<div class="x-confirm-title">'+r+'</div>			<div class="x-confirm-close">&times;</div>			<div class="x-confirm-content">'+i+'</div>			<div class="x-confirm-btns">'+(n=="confirm"?'<button class="x-confirm-btn cancel">'+o+"</button>":"")+'<button class="x-confirm-btn confirm">'+s+"</button>			</div>		</div>",c=e(l);t.cls&&c.addClass(t.cls),t.contentCls&&e(".x-confirm-content",c).addClass(t.contentCls);var h=function(){c.slideUp(200,function(){c.remove(),e(".dialog-layer").removeClass("active"),f&&f()})};return e(".x-confirm-btns .confirm",c).on("click",function(){h(),u&&u()}),e(".x-confirm-close,.x-confirm-btns .cancel",c).on("click",function(){h(),a&&a()}),c.appendTo(e(".dialog-layer")).css({top:-c.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active"),c}function r(e,t,n){return t=t||"li",n?e.hasClass("active")?(e.removeClass("active"),!1):(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0):e.hasClass("active")?!1:(e.parent().find(t+".active").removeClass("active"),e.addClass("active"),!0)}return{message:t,confirm:n,toggleActive:r}}),define("../app/hardware",["jquery","jquery-ui","jquery.cookie","go","./nodeTemplate","./EventManager","./util"],function(e,t,t,t,n,r,i){function y(){u=go.GraphObject.make,a=u(go.Diagram,c,{initialContentAlignment:go.Spot.Center,allowClipboard:!1,allowCopy:!1,allowTextEdit:!1,allowReshape:!1,allowRelink:!1,allowLink:!0,maxSelectionCount:1,"toolManager.hoverDelay":500,"clickCreatingTool.isEnabled":!1,"clickCreatingTool.isDoubleClick":!1,"linkingTool.portGravity":50,"linkingTool.linkValidation":Z,"relinkingTool.linkValidation":Z,"grid.visible":!0,"toolManager.mouseWheelBehavior":go.ToolManager.WheelZoom,"dragSelectingTool.isEnabled":!1,"animationManager.isEnabled":!1,click:V,doubleClick:$,contextClick:J,PartCreated:K}),a.grid=u(go.Panel,"Grid",u(go.Shape,"LineH",{stroke:"#EBEFF7"}),u(go.Shape,"LineV",{stroke:"#EBEFF7"}),u(go.Shape,"LineH",{stroke:"#F0F3F8",interval:5}),u(go.Shape,"LineV",{stroke:"#F0F3F8",interval:5}));for(var e in n.node){var t=n.node[e];a.nodeTemplateMap.add(e=="default"?"":e,t)}a.linkTemplate=n.link,a.nodeSelectionAdornmentTemplate=n.nodeSelection,a.linkSelectionAdornmentTemplate=n.linkSelection,a.toolManager.linkingTool.temporaryLink=u(go.Link,u(go.Shape,{stroke:"#95a3ad",strokeWidth:2}));var r=u(go.Node,u(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));a.toolManager.linkingTool.temporaryFromNode=r,a.toolManager.linkingTool.temporaryFromPort=r.port;var i=u(go.Node,u(go.Shape,{stroke:null,fill:null,portId:"",width:0,height:0}));a.toolManager.linkingTool.temporaryToNode=i,a.toolManager.linkingTool.temporaryToPort=i.port;var s=a.toolManager.clickCreatingTool;s.insertPart=function(e){return this.archetypeNodeData=R(this.archetypeNodeData.name),go.ClickCreatingTool.prototype.insertPart.call(this,e)},s=a.toolManager.linkingTool,s.doActivate=function(){var e=this.findLinkablePort();return j(e),go.LinkingTool.prototype.doActivate.call(this)},s.doDeactivate=function(){var e=go.LinkingTool.prototype.doDeactivate.call(this);return j(),e};var o=u(go.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort"});a.model=o,g={},N(),k(p)}function b(e){f=e}function w(){return{model:a.model.toJson(),componentConuts:componentConuts}}function E(e){e=e||{},e.model?a.model=go.Model.fromJson(e.model):(a.clear(),D()),componentConuts=e.componentConuts||[],j(),F(),I(!1)}function S(){return p}function x(e){if(p!="modern")return;var t=a.toolManager.clickCreatingTool;t.isEnabled=!0,t.archetypeNodeData={name:e};var n=q(e);h.attr("src",n.source).css({width:n.width,height:n.height,left:-999}),L()}function T(){var e=[],t=B(),n=t.findNodesConnected().iterator,r,i,s,o,u,a;while(n.next()){r=n.value,i=r.data,s=[],u=t.findLinksBetween(r).iterator;while(u.next())o=u.value,a=o.fromPort.part.data.type,a=="board"?s.push({source:o.toPort.portId,target:o.fromPort.portId}):s.push({source:o.fromPort.portId,target:o.toPort.portId});e.push({name:i.name,headCode:i.headCode,varCode:i.varCode,setupCode:i.setupCode,varName:i.varName,ports:s})}return e.sort(function(e,t){var n=e.name.localeCompare(t.name);return n==0?e.varName.localeCompare(t.varName):n})}function N(){l=e("#"+c).droppable({disabled:!0,scope:"hardware",drop:et}),h=e(".hardware .follow .follower"),e(".hardware .tools .interactive-mode > li").on("click",_),e(".hardware .tools .mode > li").on("click",M),r.bind("hardware","nodeClick",Q),r.bind("hardware","linkClick",G),r.bind("hardware","portClick",Y)}function C(t){e('.hardware .tools .mode li[data-mode="'+t+'"').click()}function k(t){t=="drag"?e('.hardware .tools .interactive-mode li[data-mode="modern"]').click():e('.hardware .tools .interactive-mode li[data-mode="drag"]').click()}function L(e){l.off("mousemove",A),h.css({left:-999});if(p!="modern"||d!="default"&&d!="clone")return;if(e===undefined&&!a.toolManager.clickCreatingTool.isEnabled)return;if(e==0){a.toolManager.clickCreatingTool.isEnabled=!1;return}l.on("mousemove",A),l.off("mouseout").on("mouseout",O)}function A(e){h.css({top:e.offsetY-h.height()/2,left:e.offsetX-h.width()/2})}function O(e){h.css({left:-999})}function M(t){var n=e(this);i.toggleActive(n),d=n.data("mode");var r=a.toolManager.clickCreatingTool,s=p=="modern";switch(d){case"default":r.isEnabled=s;break;case"clone":r.isEnabled=s;break;case"delete":r.isEnabled=!1}L()}function _(t,n){var i=e(this).addClass("hide"),s=i.data("mode"),o=e('.hardware .tools .mode li[data-mode="clone"]');s=="drag"?(p="modern",i.parent().find('li[data-mode="'+p+'"]').removeClass("hide"),o.removeClass("hide")):(p="drag",i.parent().find('li[data-mode="'+p+'"]').removeClass("hide"),o.addClass("hide")),l.droppable("option","disabled",p!="drag"),C("default"),e.cookie("interactiveMode",p),r.trigger("hardware","changeInteractiveMode",p)}function D(){P("ArduinoUNO",0,0,!0)}function P(e,t,n,r){var i=R(e,r);typeof t=="number"&&typeof n=="number"&&(i.location=t+" "+n);var s=a.model;return s.addNodeData(i),i}function H(e,t,n,r){var i={from:e,to:t,fromPort:n,toPort:r},s=a.model;return s.addLinkData(i),i}function B(){var e=a.nodes.iterator,t;while(e.next()){t=e.value;if(t.data.type=="board")return t}}function j(e){var t=B();if(!t)return;var n=t.ports.iterator,r;while(n.next())r=n.value,X(r)?r.fill="#4891ed":r.fill="#ffe42b";v&&v.diagram&&(v.fill="#F1C933"),v=e;if(v){v.fill="#F19833";var i=v.part.data.type;if(i=="component"){n.reset();while(n.next()){r=n.value;if(X(r)||!W(v,r))r.fill="#4891ed"}}}}function F(e){m&&m.diagram&&(m.fromPort.fill="#F1C933",m.toPort.fill="#4891ed"),m=e,m&&(m.fromPort.fill="#F19833",m.toPort.fill="#F19833")}function I(t){var n=e(".hardware .name-dialog");if(t){var r=e(".name",n).val(t.varName).off("blur").on("blur",function(e){var n=tt(t.key,r.val());n.success||(r.val(t.varName),i.message(n.message))});if(n.css("display")=="block"){var s=tt(t.key,r.val());s.success||(r.val(t.varName),i.message(s.message))}n.show()}else n.hide()}function q(e,t){return t?f.boards[e]:f.components[e]}function R(t,n){var r=q(t,n),i=e.extend(!0,{},r),s=(new Date).getTime();i.key=t+"_"+s;var o=g[t]||0;return i.varName+=o,o++,g[t]=o,i}function U(e){var t=e.part,n=t.data.ports;return n[e.portId]}function z(e){var t=e.part,n=t.findLinksConnected(e.portId).iterator;return n.next(),n.value}function W(e,t){var n=U(e),r=U(t);return n.type==r.type}function X(e){var t=e.part;return t.findLinksConnected(e.portId).count>0}function V(e){j(),F(),I(!1)}function $(e){r.trigger("project","switchPanel",1)}function J(e){C("default"),L(!1)}function K(e){d=="default"&&(a.toolManager.clickCreatingTool.isEnabled=!1),L()}function Q(e){j(),F();if(d=="default"){var t=e.data,n=t.type;n=="component"?I({varName:t.varName,key:t.key}):I(!1)}else d=="delete"?(I(!1),e.deletable&&a.remove(e)):I(!1)}function G(e){j(),I(!1),d=="delete"?(e==m&&(F(),m=null),a.remove(e)):(d=="default"||d=="clone")&&F(e)}function Y(e){F(),I(!1);if(p=="modern"&&d=="default"){var t=e.part,n=t.data.type;if(!v)j(e);else{var r=v.part.data.type;if(r=="component")if(n=="component"){if(!X(v)||X(e)){j();return}var i=z(v),s=i.getOtherPort(v);if(!W(e,s)){j();return}a.remove(i);var o=s.part.data.key,u=e.part.data.key;H(o,u,s.portId,e.portId),j()}else{if(X(v)||X(e)||!W(v,e)){j();return}var o=v.part.data.key,u=e.part.data.key;H(o,u,v.portId,e.portId),j()}else if(n=="component"){if(X(v)||X(e)||!W(v,e)){j();return}var o=v.part.data.key,u=e.part.data.key;H(o,u,v.portId,e.portId),j()}else{if(!X(v)||X(e)){j();return}var i=z(v),s=i.getOtherPort(v);if(!W(e,s)){j();return}a.remove(i);var o=s.part.data.key,u=e.part.data.key;H(o,u,s.portId,e.portId),j()}}}else j()}function Z(e,t,n,r){return!X(t)&&!X(r)&&W(t,r)}function et(t,n){var r=n.helper.first(),i=r.data("component-name"),s=r.width(),o=r.height(),u=r.offset().left+s/2,f=r.offset().top+o/2,l=q(i);switch(l.category){case"one-port-top":case"two-port-top":f-=3.5;break;case"one-port-bottom":case"two-port-bottom":f+=3.5;break;case"one-port-right":u+=3.5}var c=e(a.div).offset(),h=new go.Point(u-c.left,f-c.top);h=a.transformViewToDoc(h),P(i,h.x,h.y)}function tt(e,t){if(t=="")return{message:"变量名不能为空",success:!1};if(s.indexOf(t)>=0)return{message:"变量名不能是关键字",success:!1};if(!o.test(t))return{message:"变量名只能由字母、数字或下划线组成，且不能以数字开头",success:!1};var n=a.model.nodeDataArray;for(var r=0;r<n.length;r++){var i=n[r];if(i.key!=e&&i.name==t)return{message:"变量名重复",success:!1}}var i=a.model.findNodeDataForKey(e);return i?(i.varName=t,{success:!0}):{message:"非法操作",success:!0}}var s=["asm","do","if","return","typedef","auto","double","inline","short","typeid","bool","dynamic_cast","int","signed","typename","break","else","long","sizeof","union","case","enum","mutable","static","unsigned","catch","explicit","namespace","static_cast","using","char","export","new","struct","virtual","class","extern","operator","switch","void","const","false","private","template","volatile","const_cast","float","protected","this","wchar_t","continue","for","public","throw","while","default","friend","register","true","delete","goto","reinterpret_cast","try","_Bool","_Complex","_Imaginary"],o=/^[_a-zA-Z][_a-zA-Z0-9]*$/,u,a,f,l,c="hardware-container",h,p=e.cookie("interactiveMode")||"modern",d="default",v,m,g;return{init:y,load:b,getData:w,setData:E,getInteractiveMode:S,setPlaceComponent:x,getNodes:T}}),define("../app/user",["jquery","./EventManager","./util"],function(e,t,n){function s(){l(),c()}function o(){return r?r.id:0}function u(){return r}function a(t){e.ajax({type:"GET",url:"/auth/check",dataType:"json"}).done(function(e){var n=e.code==0;r=n?e.user:null,t&&t(n)})}function f(t,i){var s=e("#login_dialog");e(".qrLoginBtn, .baseLoginBtn",s).off("click").on("click",function(n){var r=e(this).data("action");r=="qrLogin"?(e(".qrLoginBtn, .qrLogin").removeClass("active"),e(".baseLoginBtn, .baseLogin").addClass("active"),e(".qrLoginBtn").css({display:"none"}),e(".baseLoginBtn").css({display:"block"}),e("#use_weixin").removeClass("active"),h(!1)):(e(".baseLoginBtn, .baseLogin").removeClass("active"),e(".qrLoginBtn, .qrLogin").addClass("active"),e(".baseLoginBtn").css({display:"none"}),e(".qrLoginBtn").css({display:"block"}),h(!0,t))}),e(".btn-login",s).off("click").on("click",function(){e.ajax({type:"POST",url:"/snspostlogin",dataType:"json",data:{email:e(".email",s).val(),password:e(".password",s).val()}}).done(function(i){i.code==0?(n.message(i.message),e("#login_dialog .close-btn").click(),r=i.data,p(),t&&t()):i.code!=1&&e(".baseLogin .message span").show().html(i.message).delay(2e3).queue(function(){e(this).fadeOut().dequeue()})})}),i=i||0,i==0?e(".qrLoginBtn").click():e(".baseLoginBtn").click(),s.css({top:-s.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function l(){var t=e("#login_dialog"),n=e("#use_weixin");e(".close-btn",t).on("click",function(r){t.slideUp(100,function(t,r){n.removeClass("active"),e(".dialog-layer").removeClass("active")}),h(!1)}),e(".qrLogin .qrcode").hover(function(t){var r=e(this).offset().top,i=e(this).offset().left;n.is(":animated")||n.addClass("active").show().css({top:r-160,left:i+50,opacity:0}).animate({left:i+260,opacity:1})},function(t){var r=e(this).offset().left;n.is(":animated")||n.animate({left:r+420,opacity:0},null,null,function(){n.removeClass("active").hide()})}),e("form",t).on("keyup",function(n){n.keyCode==13&&e(".baseLogin",t).hasClass("active")&&e(".btn-login",t).trigger("click")})}function c(){var t=e(".user"),n=e(".dialog",t),r=e(".indent",t),i=e(".software .back");e(".close-btn",n).on("click",function(){n.slideUp(200,function(e){r.show()}),i.removeClass("active")}),r.on("click",function(){n.slideDown(400,function(){r.hide()}),i.addClass("active")})}function h(s,o){clearInterval(i),s&&(i=setInterval(function(){var i=e("#qrcode_key").val();e.ajax({url:"/weixinlogin?key="+i,dataType:"json"}).done(function(i){i.code==0?(r=i.data,h(!1),n.message(i.message),e("#login_dialog .close-btn").click(),p(),o&&o(),t.trigger("user","login")):i.code==1&&(r=i.data,h(!1),p())})},3e3))}function p(){var t=e(".user"),n=e(".software .back");r?(t.addClass("active"),n.addClass("active"),e(".photo img",t).attr("src",r.avatar_url),e(".name",t).text(r.name)):(t.removeClass("active"),n.removeClass("active"),e(".name",t).text(""),e(".photo img",t).attr("src","#"))}var r,i;return{init:s,getUserId:o,getUserInfo:u,authCheck:a,showLoginDialog:f}}),define("../app/code",[],function(){function u(e){t=e}function a(t){var n=t.split("\n");for(var r=0;r<n.length;r++){var i=n[r];i!=""&&e.indexOf(i)<0&&e.push(i)}}function f(e){n=[],r=[],i=[],m();if(!e){var t=s,o=l();o!=""&&(t+="\n"+o);var u=c();u!=""&&(t+="\n"+u+"\n"),t+="void setup() {\n";var a=h();return a!=""&&(t+=a),t+="    \n}\n\n",t+="void loop() {\n    \n}",t}return e=v(e,l(),"head"),e=v(e,c(),"variable"),e=v(e,h(),"setup"),e}function l(){for(var t=0;t<e.length;t++){var r=e[t];r!=""&&n.indexOf(r)<0&&n.push(r)}n=n.sort(function(e,t){return e.localeCompare(t)});var i="",s="";for(var t=0;t<n.length;t++)s+=n[t]+"\n";return i+=d(s,"head"),i}function c(){var e="",t="";for(var n=0;n<r.length;n++)t+=r[n];return e+=d(t,"variable"),e}function h(){var e="",t="";for(var n=0;n<i.length;n++)t+=i[n];return e+=d(t,"setup","    "),e}function p(e){e=e||1;var t="";for(var n=0;n<e;n++)t+="    ";return t}function d(e,t,n){return n=n||"",o.replace("{{code}}",e).replace("{{tag}}",t).replace(/\{\{indent\}\}/g,n)}function v(e,t,n){var r="//end auto generate. block tag: "+n,i=e.indexOf(r);if(i<0)return e;var s="//auto generate",o=e.lastIndexOf(s,i);return o<0?e:(o=e.lastIndexOf("\n",o)+1,i=i+r.length+1,e.replace(e.substring(o,i),t))}function m(){var e=t();for(var s=0;s<e.length;s++){var o=e[s];if(o.headCode!=""){var u=o.headCode.split("\n");for(var a=0;a<u.length;a++){var f=u[a];f!=""&&n.indexOf(f)<0&&n.push(f)}}var l=o.ports,c,h=o.varCode;if(h!=""){h=h.replace(/\$NAME/g,o.varName);for(var a=0;a<l.length;a++)c=l[a],h=h.replace("$"+c.source,c.target);r.push(h)}var p=o.setupCode;if(p!=""){p=p.replace(/\$NAME/g,o.varName);for(var a=0;a<l.length;a++)c=l[a],p=p.replace("$"+c.source,c.target);p=p.replace(/([^\n]*\n)/g,"    $1"),i.push(p)}}}var e=[],t,n,r,i,s="/************************************************************\n *Copyright(C), 2016-2038, KenRobot.com\n *FileName:  //文件名\n *Author:    //作者\n *Version:   //版本\n *Date:      //完成日期\n */\n",o="{{indent}}//auto generate\n{{indent}}//warning: please don't modify\n{{code}}{{indent}}//end auto generate. block tag: {{tag}}\n";return{init:u,gen:f,addLibrary:a}}),define("../app/software",["ace/ace","ace/ext-language_tools","jquery","./EventManager","./code"],function(e,e,t,n,r){function s(e){i=ace.edit(t(".software .editor")[0]),i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),i.setShowPrintMargin(!1),i.$blockScrolling=Infinity,i.setTheme("ace/theme/default"),i.session.setMode("ace/mode/arduino"),t(".software .back").on("click",function(e){n.trigger("project","switchPanel",0)}),r.init(e)}function o(e){e=e||{};var t=e.source||r.gen();i.setValue(t,1)}function u(){return{source:i.getValue()}}function a(){i.setValue(r.gen(i.getValue()),1)}function f(e){r.addLibrary(e.code)}var i;return{init:s,getData:u,setData:o,gen:a,addLibrary:f}}),define("../app/board",["jquery","./util"],function(e,t){function s(){i=".board .list > li.normal",e(i).on("click",f)}function o(t){r=t,e(i).eq(0).click()}function u(){return{id:n.id,name:n.name,board_type:n.board_type}}function a(t){t=t||{};var n=t.id||1;for(var s in r){var o=r[s];if(o.id==n){e(i).filter('[data-board="'+s+'"]').click();break}}}function f(i){var s=e(this),o=s.data("board");n=r[o],t.toggleActive(s)}var n,r,i;return{init:s,load:o,getData:u,setData:a}}),define("../app/project",["jquery","./EventManager","./util","./config","./user","./hardware","./software","./board"],function(e,t,n,r,i,s,o,u){function c(){e(".project .operation li").on("click",w),t.bind("project","switchPanel",k),t.bind("user","login",L),d()}function h(t){var n=function(){var n=l.project_name,r=u.getData(),i=o.getData();e.ajax({type:"POST",url:"/build",data:{source:i.source,project_name:n,build_type:"Arduino",board_type:r.board_type},dataType:"json"}).done(function(e){t&&t(e)})};r.buildAuth?i.authCheck(function(e){if(!e){i.showLoginDialog(n);return}n()}):n()}function p(t){var n=e("#save-dialog"),r=e("form",n),i=t?M():l;e('input[name="name"]',r).val(i.project_name),e('textarea[name="intro"]',r).val(i.project_intro),e('input[name="public-type"][value="'+i.public_type+'"]',r).attr("checked",!0);var s=t?"创建项目":"保存项目";e('input[name="save"]',r).val(s),e(".close-btn",n).off("click").on("click",function(t){n.slideUp(100),e(".dialog-layer").removeClass("active")}),e(".save",n).off("click").on("click",function(){m(i.id)}),n.css({top:-n.height()}).show().animate({top:200},400,"swing"),e(".dialog-layer").addClass("active")}function d(){i.authCheck(function(t){t?e.ajax({url:"/projects/"+i.getUserId(),dataType:"json"}).done(v):(a.push(M()),C(0))})}function v(t){t.status!=0?a=[]:a=t.data,a.length==0&&a.push(M());var n=e(".project .list ul").empty();for(var r=0;r<a.length;r++){var i=a[r];try{i.project_data=JSON.parse(i.project_data)}catch(s){console.log(s.message),i.project_data={}}n.append(O(i))}C(-1)}function m(t){var r=e("#save-dialog form"),s={id:t,project_name:e('input[name="name"]',r).val(),user_id:i.getUserId(),project_intro:e('textarea[name="intro"]',r).val(),project_data:JSON.stringify(A()),public_type:e("input[name='public-type']:checked",r).val()};e("#save-dialog .close-btn").click(),e.ajax({type:"POST",url:"/project/save",data:s,dataType:"json"}).done(function(r){n.message(r.message),r.status==0&&e.ajax({url:"project/"+r.data.project_id,dataType:"json"}).done(function(e){g(t,e)})})}function g(t,r){if(r.status!=0){n.message(r.message);return}var i=r.data,s=e(".project .list > ul");if(t==0){s.find('> li[data-project-id="0"]').remove();for(var o=0;o<a.length;o++){var u=a[o];if(u.id==0){a.splice(o,1);break}}a.push(i),s.append(O(i)),l=i,C(-1)}else{var f=-1;for(var o=0;o<a.length;o++){var u=a[o];if(u.id==i.id){f=o;break}}a[f]=i,s.find('> li[data-project-id="'+i.id+'"]').find(".name").text(i.project_name),l=i}}function y(t){var r=e(this).parent(),i=e(".sidebar .project .list").data("operation");if(i!="delete"){l&&(l.project_data=A());if(n.toggleActive(r,null,!0)){var a=r.data("project-id");l=a==0?M():_(a);var f=l.project_data;u.setData(f.board),s.setData(f.hardware),o.setData(f.software);var c=r.find(".view > div");c.filter(".active").length==0?c.eq(0).click():c.filter(".active").click()}}}function b(t){var r=l.project_data,i=e(this);n.toggleActive(i,"div");var u=i.index(),a=e(".sidebar .bar ul > li"),f=e(".sidebar .tab");if(u==0){a.filter('[data-action="board"],[data-action="component"]').removeClass("hide"),a.filter('[data-action="library"]').addClass("hide"),f.filter(".tab-board,.tab-component").removeClass("hide"),f.filter(".tab-library").addClass("hide");var c=a.filter('[data-action="component"]');c.hasClass("active")||c.click(),r.software=o.getData()}else{a.filter('[data-action="board"],[data-action="component"]').addClass("hide"),a.filter('[data-action="library"]').removeClass("hide"),f.filter(".tab-board,.tab-component").addClass("hide"),f.filter(".tab-library").removeClass("hide");var h=a.filter('[data-action="project"]');h.hasClass("active")||h.click(),r.hardware=s.getData(),o.gen()}e(".main > .tabs").css({"margin-left":e(".sidebar").width()}),e(".main > .tabs .tab").removeClass("active").eq(u).addClass("active")}function w(t){var n=e(this),r=n.data("action");switch(r){case"new":E();break;case"delete":S();break;case"cancel":T();break;case"confirm":N()}}function E(e){i.authCheck(function(e){e?p(!0):i.showLoginDialog()})}function S(e){if(l.id==0){n.message("你的项目尚未保存");return}i.authCheck(function(e){if(e){var t=function(){x(l.id)};n.confirm({title:"删除确认",text:"删除后不可恢复，确定要删除该项目吗？",okFunc:t})}else i.showLoginDialog()})}function x(t){e.ajax({type:"POST",url:"/project/delete",data:{id:t,user_id:i.getUserId()},dataType:"json"}).done(function(r){n.message(r.message);if(r.status==0){var i=e('.project .list > ul > li[data-project-id="'+t+'"]').remove();for(var s=0;s<a.length;s++){var o=a[s];if(o.id==t){a.splice(s,1);break}}console.log("aaaaaaaa"+a.length);if(a.length==0){var u=M();a.push(u),e(".project .list > ul").append(O(u)),C(-1)}else{var f=e(".project .list .title");f.eq(f.length-1).click()}}})}function T(e){}function N(e){}function C(t){e(".project .list .view > div").off("click").on("click",b);var n=e(".project .list .title").off("click").on("click",y);typeof t=="number"&&(t==-1?n.eq(n.length-1).click():e('.project .list >  ul > li[data-project-id="'+t+'"] .title').click())}function k(t){e(".project .list .view > div.active").parent().find("div").eq(t).click()}function L(){e.ajax({url:"/projects/"+i.getUserId(),dataType:"json"}).done(v)}function A(){return{board:u.getData(),hardware:s.getData(),software:o.getData()}}function O(e){return f.replace(/\{\{project_name\}\}/g,e.project_name).replace(/\{\{id\}\}/g,e.id)}function M(){return{id:0,user_id:i.getUserId(),project_name:"我的项目",project_intro:"我的项目简介",public_type:1,project_data:{}}}function _(e){for(var t=0;t<a.length;t++){var n=a[t];if(n.id==e)return n}}var a=[],f='<li data-project-id="{{id}}"><div class="title"><span class="name">{{project_name}}</span><i class="iconfont icon-lashenkuangxiangxia"></i></div><div class="view"><div><span class="name">{{project_name}}</span>.uno</div><div><span class="name">{{project_name}}</span>.ino</div></div></li>',l;return{init:c,build:h,showSaveDialog:p}}),define("../app/extAgent",["jquery.cookie","./config","./util","./user","./project"],function(e,t,n,r,i){function u(e){var i=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(!i&&!window.chrome){n.message("Kenrobot平台扩展目前只支持Chrome浏览器，其它浏览器敬请期待！");return}f(function(n){if(!n){m();return}var i=function(){a(e)};t.extension.launchAuth?r.authCheck(function(e){e?i():r.showLoginDialog(i)}):i()})}function a(e){clearInterval(s),window.location=e,o=[],s=setInterval(l,1e3)}function f(e){chrome.runtime.sendMessage(t.extension.appId,"isInstalled",function(t){t&&t.action=="isInstalled"&&t.result==1?e(!0):e(!1)})}function l(){var e=o.length>0?o.shift():"nothing";c(e)}function c(e){chrome.runtime.sendMessage(t.extension.appId,e,h)}function h(e){if(!e||e=="nothing")return;var t=$.isArray(e)?e:[e];for(var n=0;n<t.length;n++){var r=t[n],i=r.action;i=="init"?p(r):i=="build"?d(r):i=="setCookie"?v(r):i=="arduinoDriver"&&y()}}function p(e){var n;try{n=JSON.parse($.cookie("serial-"+e.id))}catch(r){n={}}o.push({action:e.action,result:{host:window.location.protocol+"//"+window.location.host,cookie:n,config:{arduinoDriverUrl:t.extension.arduinoDriverUrl,burnDelay:t.extension.burnDelay}}})}function d(e){i.build(function(t){o.push({action:e.action,result:t})})}function v(e){$.cookie("serial-"+e.id,JSON.stringify(e.cookie)),o.push({action:e.action,result:!0})}function m(){n.confirm({title:"安装",cls:"extension-dialog",contentCls:"selectable",type:"info",text:'你没有安装啃萝卜<span class="strong">KenExt.crx</span>，请按以下步骤操作:<div class="step">Step 1: 点击<a href="http://platform.kenrobot.com/download/KenExt.crx" title="啃萝卜">下载</a><br />Step 2: 打开chrome浏览器，在地址栏输入<span class="strong">chrome://extensions</span><br />Step 3: 把<span class="strong">KenExt.crx</span>拖入浏览器<br />Step 4: 完成安装</div><div class="des">说明: 如果顶部弹出“无法添加来自此网站的应用...”，请点击确定。由于一些你懂的原因，我们不能把插件发布到google应用商店。就算能发布，部分用户也不能...，所以<span class="helpless">╮(╯▽╰)╭</span></div>'})}function y(){if(g)return;var e;navigator.userAgent.indexOf("WOW64")!=-1||navigator.userAgent.indexOf("Win64")!=-1?e=64:e=32;var t="http://platform.kenrobot.com/download/arduino-driver-x"+e+".zip";n.confirm({title:"驱动问题",cls:"arduino-driver-dialog",contentCls:"selectable",type:"info",text:'如果你遇到了Arduino<span class="strong">驱动问题</span>，请按以下步骤操作:<div class="step">Step 1: 点击<a href="'+t+'" title="Arduino驱动">下载</a>并解压<br />Step 2: 运行<span class="strong">arduino驱动安装.exe</span><br />Step 3: 完成安装</div>',closeFunc:function(){g=!1}}),g=!0}var s,o,g;return{init:u}}),define("../app/sidebar",["jquery","./EventManager","./util","./config","./user","./project","./board","./software","./extAgent"],function(e,t,n,r,i,s,o,u,a){function f(){e(".sidebar .logo").on("click",l),e(".sidebar .bar ul > li").on("click",c).filter('[data-action="component"]').click()}function l(e){i.authCheck(function(e){e?n.message("你已登录"):i.showLoginDialog(null,1)})}function c(t){var r=e(this),i=r.index(),s=r.data("action");switch(s){case"save":h();break;case"download":p();break;case"serial":d();break;case"burn":v();break;default:var o=e(".sidebar .tab.tab-"+s);n.toggleActive(r,null,!0);var u=n.toggleActive(o,".tab",!0);e(".main > .tabs").css({"margin-left":e(".sidebar").width()})}}function h(){i.authCheck(function(e){e?s.showSaveDialog():i.showLoginDialog(s.showSaveDialog)})}function p(){s.build(function(e){n.message(e.message),e.status==0&&e.url&&(window.location.href=e.url)})}function d(){a.init(r.extension.debugUrl)}function v(){a.init(r.extension.burnUrl)}return{init:f}}),define("../app/component",["jquery","jquery-ui","bootstrap-typeahead","./EventManager","./util","./hardware"],function(e,t,t,n,r,i){function a(){u=e(".component .items .list > li").on("click",c).draggable({disabled:!0,appendTo:".drag-layer",scope:"hardware",revert:!0,revertDuration:0,zIndex:9999,containment:"window",helper:h}),n.bind("hardware","changeInteractiveMode",l)}function f(e){o=e,p()}function l(e){u.draggable("option","disabled",e!="drag")}function c(t){var n=e(this);r.toggleActive(n),i.setPlaceComponent(n.data("component-name"))}function h(t){var n=e(this).data("component-name"),r=o[n];return e(".image",this).clone().css({width:r.width,height:r.height}).data("component-name",n)}function p(){var t=[];for(var n in o)t.push(o[n]);e(".search .key").typeahead({source:t,displayText:function(e){return typeof e!="undefined"&&typeof e.label!="undefined"&&e.label||e},updater:function(t){return e('.component .items .list > li[data-component-name="'+t.name+'"').click(),t}})}var s,o,u;return{init:a,load:f}}),define("../app/library",["jquery","./software"],function(e,t){function r(){e(".library .list > li").on("click",s)}function i(e){n=e}function s(r){var i=e(this),s=i.data("library"),o=n[s];if(!o)return;t.addLibrary(o),t.gen()}var n;return{init:r,load:i}}),define("../app/guide",["jquery","./config","./util"],function(e,t,n){function i(){r=t.guide;var n=e(".guide-layer");r.showIfFirstVisit?(n.on("click",s).show(),s()):n.remove()}function s(){var t=e(".guide-step"),r=t.filter(".active").index();if(r+1<t.length){r+=1;var i=t.eq(r);n.toggleActive(i,"div"),r+1==t.length&&i.css({left:(e(window).width()-i.width())/2})}else e(".guide-layer").remove()}var r;return{init:i}}),define("../app/app-index",["jquery","./config","./hardware","./user","./project","./software","./sidebar","./board","./component","./library","./guide"],function(e,t,n,r,i,s,o,u,a,f,l){function c(){p(),h(),r.init(),o.init(),u.init(),a.init(),f.init(),n.init(),s.init(n.getNodes),l.init(),e.ajax({url:"/config",dataType:"json"}).done(d)}function h(){e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}})}function p(){if(t.needPV){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?6518098de0bee39bef219952dbbae669";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}function d(e){u.load(e.boards),a.load(e.components),f.load(e.libraries),n.load(e),i.init()}return{init:c}});